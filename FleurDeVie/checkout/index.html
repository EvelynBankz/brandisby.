<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fleur De Vie - Checkout</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:"Montserrat",sans-serif;background:#F5E6CC;color:#112e1f;line-height:1.6}
    a{text-decoration:none;color:inherit}
    .site-header{background:#112e1f;color:#F5E6CC;display:flex;justify-content:space-between;align-items:center;padding:16px 28px;position:fixed;top:0;left:0;right:0;z-index:1000}
    .brand-logo{height:60px}
    .brand-title{font-family:"Playfair Display",serif;font-weight:700;font-size:24px}
    .header-right{display:flex;gap:18px;align-items:center}
    .header-right a{font-weight:500;transition:color .2s}
    .header-right a:hover{color:#FFD6BA}
    .cart-count{background:#FFD6BA;color:#112e1f;border-radius:50%;padding:2px 6px;font-weight:600;font-size:12px;margin-left:6px}
    .hamburger{display:none}
    .hero{position:relative;height:40vh;display:flex;align-items:center;justify-content:center;margin-top:80px;text-align:center}
    .hero::after{content:"";position:absolute;inset:0;background:url('../bg.jpg') center/cover no-repeat;transform:scale(1.08);z-index:-1;border-radius:12px;box-shadow:inset 0 0 0 2000px rgba(17,46,31,0.18)}
    .hero-text h1{font-family:"Playfair Display",serif;color:#FFD6BA;font-size:clamp(28px,5vw,48px)}
    section.checkout{padding:60px 20px}
    /* REDUCED billing form width, INCREASED order summary width */
    .container{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr 1.6fr;gap:28px}
    .checkout-form,.order-summary{border-radius:12px;padding:18px;box-shadow:0 4px 10px rgba(0,0,0,0.08)}
    .checkout-form{background:#FFD6BA}
    .order-summary{background:#C9E4FF} /* requested bg color */
    h2{font-family:"Playfair Display",serif;margin-bottom:12px;font-size:20px}
    label{display:block;margin-bottom:6px;font-weight:500}
    input,textarea,select{width:100%;padding:10px;border-radius:6px;border:1px solid #112e1f;margin-bottom:12px;font-family:inherit}
    textarea{min-height:80px;resize:vertical}
    .currency-selector{text-align:right;margin-bottom:12px}
    .checkout-btn{display:block;width:100%;background:#112e1f;color:#F5E6CC;padding:14px;border-radius:6px;border:none;font-weight:700;cursor:pointer}
    .checkout-btn:hover{background:#0a1d14}

    /* order summary / items */
    .order-summary ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:12px}
    .order-item{display:flex;gap:12px;align-items:flex-start;justify-content:space-between;padding:10px;border-radius:8px;background:rgba(255,255,255,0.6)}
    .order-item .left{flex:1 1 70%}
    .order-item .right{flex:0 0 150px;text-align:right}
    .order-item .title{font-weight:600}
    .order-item .meta{font-size:0.95rem;color:#334d3a;margin-top:6px}

    /* chevron toggle */
    .variant-toggle{
      display:inline-flex;align-items:center;justify-content:center;width:30px;height:30px;border-radius:6px;border:1px solid #112e1f;background:#FFD6BA;color:#112e1f;cursor:pointer;padding:0;margin-left:8px
    }
    .variant-toggle svg{width:14px;height:14px;transition:transform .25s ease}
    .variant-toggle[aria-expanded="true"] svg{transform:rotate(180deg)}

    /* variants dropdown (read-only) */
    .variants-container{max-height:0;overflow:hidden;transition:max-height .28s ease,padding .28s ease;padding-left:12px;border-left:2px solid rgba(17,46,31,0.08);margin-top:8px}
    .variants-container.show{max-height:500px;padding-top:8px;padding-bottom:8px}
    .variant-row{display:flex;justify-content:space-between;gap:12px;align-items:center;padding:6px 0;border-bottom:1px dashed rgba(0,0,0,0.06)}
    .variant-attrs{font-size:0.95rem;color:#334d3a}
    .variant-price{font-weight:600;min-width:110px;text-align:right}

    .subtotal{font-weight:700;text-align:right;margin-top:12px}
    .note{font-size:0.9rem;color:#666;margin-top:8px}

    footer{text-align:center;padding:20px;background:#112e1f;color:#F5E6CC;margin-top:36px}

    @media(max-width:900px){ .container{grid-template-columns:1fr} }
 
    .hamburger {
      display:none;
      font-size:26px;
      background:none;
      border:none;
      cursor:pointer;
      color:#FFD6BA;
    }

 @media(max-width:768px){
      .header-right {
        display:none;
        flex-direction:column;
        background:#fff;
        position:absolute;
        top:70px;
        right:20px;
        width:200px;
        border:1px solid #ddd;
        padding:10px;
      }
      .header-right.show {display:flex;}
      .hamburger {display:block;}
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div style="display:flex;align-items:center;gap:14px">
      <img src="../logo.png" alt="Fleur De Vie Logo" class="brand-logo">
      <div class="brand-title">Fleur De Vie</div>
    </div>
 <!-- Hamburger -->
    <button class="hamburger" id="hamburger-btn">☰</button>
    <nav class="header-right">
      <a href="../index.html">Home</a>
      <a href="../shop.html">Shop</a>
      <a href="../about.html">About</a>
      <a href="../contact.html">Contact</a>
      <a href="../cart.html">Cart <span class="cart-count" id="cartCount">0</span></a>
    </nav>
  </header>

  <section class="hero"><div class="hero-text"><h1>Checkout</h1></div></section>

  <section class="checkout">
    <div class="container">
      <!-- Billing Form -->
      <div class="checkout-form">
        <h2>Billing Details</h2>
        <form id="checkoutForm">
          <label for="name">Full Name</label>
          <input type="text" id="name" required>
          <label for="email">Email</label>
          <input type="email" id="email" required>
          <label for="phone">Phone</label>
          <input type="tel" id="phone" required>
          <label for="address">Address</label>
          <textarea id="address" required></textarea>
        </form>
      </div>

      <!-- Order Summary -->
      <div class="order-summary">
        <h2>Order Summary</h2>
        <div class="currency-selector" id="currencySelectorWrapper" style="display:none">
          <label for="currency">Currency:</label>
          <select id="currency">
            <option value="NGN">NGN</option>
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
            <option value="GBP">GBP</option>
          </select>
        </div>

        <ul id="orderItems"></ul>
        <div class="subtotal" id="orderSubtotal"></div>
        <div class="note">You will be redirected to payment after clicking Proceed to Payment.</div>
        <button id="payBtn" class="checkout-btn">Proceed to Payment</button>
      </div>
    </div>
  </section>

  <footer><p>© 2025 Fleur De Vie</p></footer>

  <script src="https://checkout.flutterwave.com/v3.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, doc, getDoc, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCuiZXHFYl1fVKnGwojavRvbekSBpkipJg",
      authDomain: "brandisby.firebaseapp.com",
      projectId: "brandisby",
      storageBucket: "brandisby.firebasestorage.app",
      messagingSenderId: "87213267039",
      appId: "1:87213267039:web:339e9fd49e3ad31f7423ea"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // DOM
    const cartCountElem = document.getElementById('cartCount');
    const orderItemsEl = document.getElementById('orderItems');
    const orderSubtotalEl = document.getElementById('orderSubtotal');
    const currencySelect = document.getElementById('currency');
    const currencyWrapper = document.getElementById('currencySelectorWrapper');
    const payBtn = document.getElementById('payBtn');

    // cart & quote
    let rawCart = JSON.parse(localStorage.getItem('cart')) || [];
    // ensure merged (in case duplicates)
    function mergeCartItems(cartArray){
      const merged=[];
      cartArray.forEach(item=>{
        const idx = merged.findIndex(i => i.id === item.id && (i.color||'') === (item.color||'') && (i.size||'') === (item.size||''));
        if(idx === -1) merged.push({...item});
        else merged[idx].quantity = Number(merged[idx].quantity||0) + Number(item.quantity||0);
      });
      return merged;
    }
    rawCart = mergeCartItems(rawCart);

    const urlParams = new URLSearchParams(window.location.search);
    const quoteId = urlParams.get('quoteId');
    let quote = null;
    let selectedCurrency = localStorage.getItem('currency') || 'NGN';
    currencySelect.value = selectedCurrency;

    // formatting
    function formatPrice(value, currency){
      const localeMap = { USD:'en-US', EUR:'de-DE', GBP:'en-GB', NGN:'en-NG' };
      const minFrac = currency === 'NGN' ? 0 : 2;
      try {
        return new Intl.NumberFormat(localeMap[currency] || 'en-US', { style:'currency', currency, minimumFractionDigits: minFrac }).format(Number(value || 0));
      } catch(e) {
        return `${currency} ${Number(value || 0).toFixed(minFrac)}`;
      }
    }

    // get authoritative unit price (from product doc or cart item)
    function getUnitPriceForCurrency(productDoc, cartItem, currency) {
      if(productDoc){
        if(currency === 'NGN' && productDoc.priceNGN != null) return Number(productDoc.priceNGN);
        if(currency === 'USD' && productDoc.priceUSD != null) return Number(productDoc.priceUSD);
        if(currency === 'EUR' && productDoc.priceEUR != null) return Number(productDoc.priceEUR);
        if(currency === 'GBP' && productDoc.priceGBP != null) return Number(productDoc.priceGBP);
        if(productDoc.price != null) return Number(productDoc.price);
      }
      if(cartItem && cartItem.price != null) return Number(cartItem.price);
      return 0;
    }

    // group cart rows by product id
    function groupCartByProduct(cartArr){
      const map = new Map();
      cartArr.forEach(row=>{
        if(!map.has(row.id)) map.set(row.id, []);
        map.get(row.id).push(row);
      });
      return map; // Map<id, [rows...]>
    }

    // fetch product docs for ids
    async function fetchProducts(productIds){
      const out = {};
      const promises = productIds.map(async id=>{
        try {
          const dref = doc(db, "brands", "fleurdevie", "products", id);
          const snap = await getDoc(dref);
          if(snap.exists()) out[id] = snap.data();
        } catch(e){
          console.warn("Failed fetch product", id, e);
        }
      });
      await Promise.all(promises);
      return out;
    }

    // build a normalized quote structure from local cart (used when no quoteId)
    async function buildQuoteFromCart(){
      const merged = mergeCartItems(rawCart);
      const byProduct = groupCartByProduct(merged);
      const productIds = Array.from(byProduct.keys());
      const productsData = await fetchProducts(productIds);

      const items = [];

      for(const pid of productIds){
        const rows = byProduct.get(pid) || [];
        const productDoc = productsData[pid] || null;
        const image = productDoc?.images?.[0] || productDoc?.imageUrl || rows[0]?.imageUrl || '';
        const name = productDoc?.name || rows[0]?.name || 'Product';

        // build variant detail rows with unitPrices & linePrices
        const variantDetails = rows.map(r => {
          const unitPrices = {
            NGN: getUnitPriceForCurrency(productDoc, r, 'NGN'),
            USD: getUnitPriceForCurrency(productDoc, r, 'USD'),
            EUR: getUnitPriceForCurrency(productDoc, r, 'EUR'),
            GBP: getUnitPriceForCurrency(productDoc, r, 'GBP')
          };
          const quantity = Number(r.quantity) || 0;
          const linePrices = {
            NGN: (unitPrices.NGN || 0) * quantity,
            USD: (unitPrices.USD || 0) * quantity,
            EUR: (unitPrices.EUR || 0) * quantity,
            GBP: (unitPrices.GBP || 0) * quantity
          };
          return {
            id: r.id,
            color: r.color || '',
            size: r.size || '',
            quantity,
            unitPrices,
            linePrices
          };
        });

        const totalQty = variantDetails.reduce((s,a)=>s + a.quantity, 0);
        const totalPrices = {
          NGN: variantDetails.reduce((s,a) => s + (a.linePrices.NGN||0), 0),
          USD: variantDetails.reduce((s,a) => s + (a.linePrices.USD||0), 0),
          EUR: variantDetails.reduce((s,a) => s + (a.linePrices.EUR||0), 0),
          GBP: variantDetails.reduce((s,a) => s + (a.linePrices.GBP||0), 0)
        };

        items.push({
          productId: pid,
          name,
          image,
          totalQuantity: totalQty,
          totalPrices,
          variants: variantDetails
        });
      }

      return { items };
    }

    // load checkout: either from quoteId (server) or cart
    async function loadCheckout(){
      // default currency
      selectedCurrency = localStorage.getItem('currency') || 'NGN';
      currencySelect.value = selectedCurrency;
      currencyWrapper.style.display = 'none';

      if(quoteId){
        // fetch quote and normalize
        try{
          const qRef = doc(db, "brands", "fleurdevie", "quotes", quoteId);
          const snap = await getDoc(qRef);
          if(!snap.exists()){
            alert("Quote not found.");
            return;
          }
          const rawQuote = snap.data();
          if(rawQuote.customer) document.getElementById('name').value = rawQuote.customer;
          if(rawQuote.email) document.getElementById('email').value = rawQuote.email;

          currencyWrapper.style.display = 'block';
          selectedCurrency = localStorage.getItem('currency') || rawQuote.currency || 'NGN';
          currencySelect.value = selectedCurrency;

          // Normalize quote items to same structure we use above
          const items = (Array.isArray(rawQuote.items) ? rawQuote.items : []).map(ci=>{
            // if ci has variants (server-side quote), map accordingly
            if(Array.isArray(ci.variants) && ci.variants.length){
              const variants = ci.variants.map(v => ({
                id: v.id || ci.id || '',
                color: v.color || '',
                size: v.size || '',
                quantity: Number(v.qty) || 0,
                unitPrices: {
                  NGN: Number(v.priceNGN) || 0,
                  USD: Number(v.priceUSD) || 0,
                  EUR: Number(v.priceEUR) || 0,
                  GBP: Number(v.priceGBP) || 0
                },
                linePrices: {
                  NGN: (Number(v.priceNGN) || 0) * (Number(v.qty) || 0),
                  USD: (Number(v.priceUSD) || 0) * (Number(v.qty) || 0),
                  EUR: (Number(v.priceEUR) || 0) * (Number(v.qty) || 0),
                  GBP: (Number(v.priceGBP) || 0) * (Number(v.qty) || 0)
                }
              }));
              return {
                productId: ci.id || '',
                name: ci.name || '',
                image: ci.image || '',
                totalQuantity: variants.reduce((s,a)=>s+a.quantity,0),
                totalPrices: {
                  NGN: variants.reduce((s,a)=>s + (a.linePrices.NGN||0),0),
                  USD: variants.reduce((s,a)=>s + (a.linePrices.USD||0),0),
                  EUR: variants.reduce((s,a)=>s + (a.linePrices.EUR||0),0),
                  GBP: variants.reduce((s,a)=>s + (a.linePrices.GBP||0),0)
                },
                variants
              };
            } else {
              // single-line item
              const qty = Number(ci.qty) || 1;
              const unitPrices = {
                NGN: Number(ci.priceNGN) || 0,
                USD: Number(ci.priceUSD) || 0,
                EUR: Number(ci.priceEUR) || 0,
                GBP: Number(ci.priceGBP) || 0
              };
              return {
                productId: ci.id || '',
                name: ci.name || '',
                image: ci.image || '',
                totalQuantity: qty,
                totalPrices: {
                  NGN: (unitPrices.NGN || 0) * qty,
                  USD: (unitPrices.USD || 0) * qty,
                  EUR: (unitPrices.EUR || 0) * qty,
                  GBP: (unitPrices.GBP || 0) * qty
                },
                variants: [{
                  id: ci.id || '',
                  color: '',
                  size: '',
                  quantity: qty,
                  unitPrices,
                  linePrices: {
                    NGN: (unitPrices.NGN || 0) * qty,
                    USD: (unitPrices.USD || 0) * qty,
                    EUR: (unitPrices.EUR || 0) * qty,
                    GBP: (unitPrices.GBP || 0) * qty
                  }
                }]
              };
            }
          });

          quote = { items };
          renderOrder();
        } catch(err){
          console.error("Failed to load quote", err);
          alert("Error loading quote. Please try again.");
        }
      } else {
        // build from client cart
        try {
          const built = await buildQuoteFromCart();
          quote = built;
          renderOrder();
        } catch(err){
          console.error("Failed to build quote from cart", err);
        }
      }

      updateCartCount();
    }

    function updateCartCount(){
      const total = rawCart.reduce((s,i)=> s + (Number(i.quantity)||0), 0);
      cartCountElem.textContent = total;
    }

    // render order: grouped product lines and per-variant rows in dropdown
    function renderOrder(){
      orderItemsEl.innerHTML = '';
      let subtotal = 0;
      const items = (quote && Array.isArray(quote.items)) ? quote.items : [];

      items.forEach(item=>{
        const lineTotal = (item.totalPrices && (item.totalPrices[selectedCurrency] ?? 0)) || 0;
        subtotal += lineTotal;

        const li = document.createElement('li');
        li.className = 'order-item';

        const left = document.createElement('div');
        left.className = 'left';

        // title + qty
        const titleDiv = document.createElement('div');
        titleDiv.className = 'title';
        titleDiv.textContent = `${item.name} (x${item.totalQuantity})`;

        // meta & toggle
        const metaDiv = document.createElement('div');
        metaDiv.className = 'meta';

        // build the header area with optional image + title + toggle
        const headerWrapper = document.createElement('div');
        headerWrapper.style.display = 'flex';
        headerWrapper.style.alignItems = 'center';
        headerWrapper.style.gap = '10px';

        if(item.image){
          const img = document.createElement('img');
          img.src = item.image;
          img.alt = item.name;
          img.style.width = '56px';
          img.style.height = '56px';
          img.style.objectFit = 'cover';
          img.style.borderRadius = '6px';
          img.style.border = '1px solid rgba(0,0,0,0.06)';
          headerWrapper.appendChild(img);
        }

        const textWrap = document.createElement('div');
        textWrap.appendChild(titleDiv);

        if(Array.isArray(item.variants) && item.variants.length > 1){
          const info = document.createElement('div');
          info.className = 'meta';
          info.textContent = 'Multiple options selected';
          textWrap.appendChild(info);
        } else {
          const singleV = item.variants && item.variants[0];
          if(singleV && (singleV.color || singleV.size)){
            const info = document.createElement('div');
            info.className = 'meta';
            info.textContent = `${singleV.color ? 'Color: ' + singleV.color : ''}${singleV.color && singleV.size ? ' · ' : ''}${singleV.size ? 'Size: ' + singleV.size : ''}`;
            textWrap.appendChild(info);
          }
        }

        headerWrapper.appendChild(textWrap);

        // right column price
        const right = document.createElement('div');
        right.className = 'right';
        right.style.minWidth = '120px';
        right.style.textAlign = 'right';
        right.innerHTML = `<div style="font-weight:600">${formatPrice(lineTotal, selectedCurrency)}</div>`;

        // if more than one variant, add chevron toggle to show variant rows
        if(Array.isArray(item.variants) && item.variants.length > 1){
          const toggle = document.createElement('button');
          toggle.className = 'variant-toggle';
          toggle.type = 'button';
          toggle.setAttribute('aria-expanded','false');
          toggle.title = 'View variants';
          // chevron svg
          toggle.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>`;

          headerWrapper.appendChild(toggle);

          // assembly
          left.appendChild(headerWrapper);

          const variantsContainer = document.createElement('div');
          variantsContainer.className = 'variants-container';
          item.variants.forEach(v=>{
            const row = document.createElement('div');
            row.className = 'variant-row';
            const leftRow = document.createElement('div');
            leftRow.style.display = 'flex';
            leftRow.style.gap = '8px';
            leftRow.style.alignItems = 'center';
            const attrs = document.createElement('div');
            attrs.className = 'variant-attrs';
            attrs.innerHTML = `${v.color ? `Color: ${v.color}` : ''}${v.color && v.size ? ' · ' : ''}${v.size ? `Size: ${v.size}` : ''} <span style="color:#556b59"> · qty: ${v.quantity}</span>`;
            leftRow.appendChild(attrs);
            const rightPrice = document.createElement('div');
            rightPrice.className = 'variant-price';
            const variantLinePrice = (v.linePrices && (v.linePrices[selectedCurrency] ?? 0)) || ((v.unitPrices && (v.unitPrices[selectedCurrency] ?? 0)) * v.quantity);
            rightPrice.textContent = formatPrice(variantLinePrice, selectedCurrency);
            row.appendChild(leftRow);
            row.appendChild(rightPrice);
            variantsContainer.appendChild(row);
          });

          left.appendChild(variantsContainer);

          // toggle wiring
          toggle.addEventListener('click', () => {
            const isShown = variantsContainer.classList.toggle('show');
            toggle.setAttribute('aria-expanded', isShown ? 'true' : 'false');
          });

        } else {
          // single variant or no variants
          left.appendChild(headerWrapper);
        }

        li.appendChild(left);
        li.appendChild(right);
        orderItemsEl.appendChild(li);
      });

      orderSubtotalEl.textContent = `Subtotal: ${formatPrice(subtotal, selectedCurrency)}`;
    }

    // payment flow
    payBtn.addEventListener('click', async function(){
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const address = document.getElementById('address').value.trim();
      if(!name || !email || !phone || !address){
        alert('Please fill in all billing details.');
        return;
      }

      // prepare items and subtotal using quote structure
      const itemsToSubmit = (quote && Array.isArray(quote.items)) ? quote.items : [];
      let subtotal = 0;
      itemsToSubmit.forEach(it=>{
        subtotal += (it.totalPrices && (it.totalPrices[selectedCurrency] ?? 0)) || 0;
      });

      if(subtotal <= 0){
        alert('Cart is empty or subtotal is zero.');
        return;
      }

      // Flutterwave checkout (replace PUBLIC KEY with real key when ready)
      FlutterwaveCheckout({
        public_key: "FLWPUBK_TEST-xxxxxxxxxxxxxxxxxxxxx-X",
        tx_ref: "fleurdevie-" + Date.now(),
        amount: subtotal.toFixed(2),
        currency: selectedCurrency,
        customer: { email, phonenumber: phone, name },
        customizations: { title: "Fleur De Vie", description: "Order Payment", logo: "../fleurdevie/logo.png" },
        callback: async function(data){
          try{
            await addDoc(collection(db, "orders"), {
              name, email, phone, address,
              currency: selectedCurrency,
              items: itemsToSubmit,
              total: subtotal.toFixed(2),
              paymentRef: data.tx_ref || data.transaction_id || null,
              status: "paid",
              createdAt: serverTimestamp()
            });
            localStorage.removeItem('cart');
            window.location.href = "../fleurdevie/thankyou.html";
          }catch(err){
            console.error("Order save failed", err);
            alert("Order save failed, but payment succeeded!");
            localStorage.removeItem('cart');
            window.location.href = "../fleurdevie/thankyou.html";
          }
        }
      });
    });

    // Initialization
    (async function init(){
      updateCartCount();
      await loadCheckout();
    })();

    // currency change
    currencySelect.addEventListener('change', ()=>{
      selectedCurrency = currencySelect.value;
      localStorage.setItem('currency', selectedCurrency);
      renderOrder();
    });

    // listen for storage changes (cart updated in another tab)
    window.addEventListener('storage', async () => {
      rawCart = JSON.parse(localStorage.getItem('cart')) || [];
      rawCart = mergeCartItems(rawCart);
      await loadCheckout();
    });
  </script>
  <script>
    // Hamburger toggle
    const hamburgerBtn = document.getElementById('hamburger-btn');
    const navMenu = document.getElementById('nav-menu');
    hamburgerBtn.addEventListener('click', () => {
      navMenu.classList.toggle('show');
      if (navMenu.classList.contains('show')) {
        hamburgerBtn.innerHTML = '✖'; // Close icon
      } else {
        hamburgerBtn.innerHTML = '☰'; // Hamburger
      }
    });
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sérac - Product</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
  --bg-dark: #141517;
  --bg-mid: #2A2B30;
  --gold: #B66E41;
  --muted: #bdbdbd;
  --accent-strong: rgba(182,110,65,0.95);
  --radius: 12px;
  --transition: 0.25s cubic-bezier(.2,.9,.2,1);
}

/* RESET */
* { margin:0; padding:0; box-sizing:border-box; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
body { font-family: "Montserrat", sans-serif; background: var(--bg-dark); color:#e6e6e6; line-height:1.6; }
a { text-decoration:none; color:inherit; transition:color var(--transition); }

/* HEADER (kept minimal — original behaviour intact) */
.site-header { background:transparent; transition: background 0.3s ease, border-bottom 0.3s ease, top 0.3s ease; color:#f5f5f5; display:flex; justify-content:space-between; align-items:center; padding:16px 28px; position:fixed; top:0; left:0; right:0; z-index:1000; border-bottom:1px solid rgba(255,255,255,0.04); }
.site-header.scrolled { background: var(--bg-dark); border-bottom:1px solid rgba(255,255,255,0.06); }

.header-left { display:flex; align-items:center; gap:14px; }
.brand-logo { height:56px; width:auto; object-fit:contain; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.6)); }
.brand-title { font-family: "Playfair Display", serif; font-size:22px; font-weight:700; color: var(--gold); letter-spacing:0.6px; }

/* NAVIGATION */
.header-right { display:flex; gap:22px; align-items:left; }
.header-right a { color:#f5f5f3; position:relative; padding:6px 0; font-size:1rem; font-weight:500; transition:color 0.3s ease; }
.header-right a::after { content:""; position:absolute; bottom:-4px; left:0; width:0; height:2px; background:var(--gold); transition:width 0.3s ease; }
.header-right a:hover { color:var(--gold); }
.header-right a:hover::after { width:100%; }
.cart-count { background:var(--gold); color:var(--bg-dark); font-size:12px; font-weight:700; border-radius:50%; padding:3px 7px; margin-left:6px; box-shadow:0 4px 10px rgba(182,110,65,0.12); }

/* HAMBURGER */
.hamburger { display:none; background:none; border:none; cursor:pointer; width:22px; height:16px; position:relative; }
.hamburger span { display:block; width:100%; height:2px; background:#b66e41; border-radius:2px; position:absolute; left:0; transition:0.3s; }
.hamburger span:nth-child(1){ top:0; } .hamburger span:nth-child(2){ top:7px; } .hamburger span:nth-child(3){ top:14px; }
.hamburger.open span:nth-child(1){ transform:rotate(45deg); top:7px; } .hamburger.open span:nth-child(2){ opacity:0; } .hamburger.open span:nth-child(3){ transform:rotate(-45deg); top:7px; }

/* MAIN PRODUCT LAYOUT (original flex layout preserved) */
main { padding:24px; max-width:1100px; margin:140px auto 60px; display:flex; gap:40px; justify-content:center; align-items:flex-start; flex-wrap:wrap; }

/* PRODUCT IMAGE SECTION (restored original style) */
.product-image { flex:1 1 400px; max-width:480px; display:flex; flex-direction:column; gap:14px; }
.product-image img { width:100%; border-radius:var(--radius); object-fit:cover; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); box-shadow:0 10px 30px rgba(2,2,2,0.7), inset 0 -2px 6px rgba(0,0,0,0.4); transition:transform var(--transition), box-shadow var(--transition); cursor:pointer; }
.product-image img:hover { transform:translateY(-6px) scale(1.01); box-shadow:0 18px 42px rgba(0,0,0,0.7); }

.thumbnail-container { display:flex; gap:10px; overflow-x:auto; scroll-behavior:smooth; padding-bottom:6px; }
.thumbnail-container img { width:70px; height:70px; border-radius:8px; object-fit:cover; border:2px solid transparent; cursor:pointer; transition:transform 0.3s ease, border-color 0.3s ease; }
.thumbnail-container img:hover { transform:translateY(-3px); }
.thumbnail-container img.selected { border-color: var(--accent-strong); box-shadow:0 6px 18px rgba(182,110,65,0.12); }

/* PRODUCT DETAILS SECTION (restored) */
.product-details { flex:1 1 400px; max-width:520px; display:flex; flex-direction:column; gap:12px; }
.product-details h1 { font-family: "Playfair Display", serif; font-size:28px; color:#fff; }
.product-details .description { font-size:15px; color:var(--muted); }
.product-details .price { font-weight:700; font-size:20px; color:#fff; margin-bottom:6px; }

/* VARIANT GROUPS: separator + label (clear grouping) */
.variant-group { margin-top:6px; padding-top:12px; border-top:1px solid rgba(255,255,255,0.03); }
.variant-label { font-size:13px; color:var(--muted); margin-bottom:8px; font-weight:700; }

/* OPTIONS (kept small) */
.options-container { display:flex; gap:8px; flex-wrap:wrap; }
.options-container button { padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:var(--muted); cursor:pointer; font-weight:600; transition:all var(--transition); font-size:0.95rem; min-width:60px; }
.options-container button:hover { color:#fff; border-color:var(--gold); }
.options-container button.selected { background:rgba(182,110,65,0.12); color:#fff; border-color:var(--accent-strong); }

/* QUANTITY (restored smaller controls) */
.quantity-controls { display:flex; align-items:center; gap:10px; }
.quantity-controls button { background:transparent; color:#fff; border:1px solid rgba(255,255,255,0.06); border-radius:10px; padding:10px 14px; cursor:pointer; font-weight:700; transition:background var(--transition), transform var(--transition); }
.quantity-controls button:hover { background:rgba(255,255,255,0.05); transform:translateY(-2px); }
.quantity-badge { font-weight:700; min-width:36px; text-align:center; color:var(--muted); }

/* BUTTONS: vertical stack (Back, Customize, Add) as you requested */
.buttons-row { display:flex; flex-direction:column; gap:10px; margin-top:10px; width:100%; max-width:360px; }
.back-btn { background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.04); border-radius:10px; padding:12px; cursor:pointer; font-size:0.98rem; font-weight:600; transition:all var(--transition); text-align:center; }
.back-btn:hover { color:#fff; }
.customize-btn { background:transparent; color:var(--accent-strong); border:1px dashed rgba(182,110,65,0.22); border-radius:10px; padding:12px; cursor:pointer; font-weight:700; transition: background var(--transition), color var(--transition); text-align:center; }
.add-cart { background:linear-gradient(90deg, var(--accent-strong), #a85a35); color:#111; border:none; border-radius:12px; padding:12px; cursor:pointer; font-size:1rem; transition:transform var(--transition), box-shadow var(--transition); box-shadow:0 8px 26px rgba(182,110,65,0.12); text-align:center; }

/* sticky single back (hidden on wide screens if you already have a visible back element) */
#backToShop { position:fixed; left:16px; bottom:20px; z-index:1200; display:flex; align-items:center; gap:8px; background:rgba(20,21,23,0.92); padding:8px 10px; border-radius:10px; box-shadow:0 10px 30px rgba(0,0,0,0.6); }

/* modal (validation) unchanged */
#optionModal { display:none; position:fixed; inset:0; background: rgba(20,21,23,0.95); justify-content:center; align-items:center; z-index:2000; }
#optionModal .modal-content { background:var(--bg-mid); padding:28px 22px; border-radius:14px; max-width:380px; text-align:center; box-shadow:0 12px 36px rgba(0,0,0,0.8); }
#optionModal .modal-content p { font-size:1rem; color:#fff; margin-bottom:18px; }
#optionModal .modal-content button { padding:10px 20px; border:none; border-radius:10px; background:var(--gold); color:var(--bg-dark); cursor:pointer; font-weight:700; transition: all 0.2s; }

/* MOBILE ADJUSTMENTS */
@media (max-width:900px) {
  main { flex-direction:column; align-items:center; padding:20px; margin-top:120px; gap:30px; }
  .product-image, .product-details { max-width:100%; width:100%; }
  .product-image img { max-height:420px; object-fit:contain; }
  .product-details { text-align:left; padding:0 10px; }
  .buttons-row { flex-direction:column; width:100%; }
  .mobile-actions { display:flex; position:fixed; bottom:18px; left:50%; transform:translateX(-50%); width:92%; max-width:640px; z-index:999; gap:10px; justify-content:center; padding:10px; background:rgba(255,255,255,0.02); border-radius:14px; box-shadow:0 12px 30px rgba(0,0,0,0.6); }
  .header-right { display:none; flex-direction:column; background:rgba(20,21,23,0.98); position:absolute; top:70px; right:0; width:220px; padding:18px; border-radius:8px; z-index:1100; }
  .header-right.open { display:flex; }
  .hamburger { display:block; }
}
</style>
</head>
<body>

<header class="site-header">
  <div class="header-left">
    <img src="asset/logo.png" alt="Sérac Logo" class="brand-logo">
    <div class="brand-title">Sérac</div>
  </div>
  <nav class="header-right">
    <a href="index.html">Home</a>
    <a href="shop.html">Shop</a>
    <a href="about.html">About</a>
    <a href="cart.html">Cart <span class="cart-count" id="cartCount">0</span></a>
    <a href="customization.html">Customize</a>
    <a href="contact.html">Contact</a>
    <a href="trackorder.html">Track</a>
  </nav>
  <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
</header>

<main id="productContainer">
  <div class="product-image">
    <img id="productImg" src="" alt="Product Image">
    <div class="thumbnail-container" id="thumbnailContainer"></div>
  </div>
  <div class="product-details">
    <h1 id="productName">Product Name</h1>
    <div class="description" id="productDescription">Product description will appear here.</div>
    <div class="price" id="productPrice">₦0.00</div>

    <div class="options-container" id="colorOptions"></div>
    <div class="options-container" id="sizeOptions"></div>

    <div class="quantity-controls">
      <button id="minus">-</button>
      <span class="quantity-badge" id="quantityBadge">0</span>
      <button id="plus">+</button>
    </div>

    <button class="add-cart" id="addCartBtn">Add to Cart</button>
    <a href="customization.html" id="customizeBtn" class="customize-btn" style="display:none;">Customize this Product</a>

    <div class="buttons-row" style="margin-bottom:12px;">
      <a href="shop.html" class="back-btn" id="backBtnDesktop">← Back to Shop</a>
    </div>

    <div class="mobile-actions" id="mobileActions" aria-hidden="true">
      <a href="shop.html" class="back-btn">← Back to Shop</a>
    </div>
  </div>
</main>

<!-- OPTION MODAL -->
<div id="optionModal">
  <div class="modal-content">
    <p>Please select all options before adding to cart.</p>
    <button id="closeModalBtn">Okay</button>
  </div>
</div>

<footer>
  <p>© 2025 Sérac</p>
</footer>

  <script type="module">
// ---------- FIREBASE INIT ----------
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
const firebaseConfig = {
  apiKey:"AIzaSyCuiZXHFYl1fVKnGwojavRvbekSBpkipJg",
  authDomain:"brandisby.firebaseapp.com",
  projectId:"brandisby",
  storageBucket:"brandisby.firebasestorage.app",
  messagingSenderId:"87213267039",
  appId:"1:87213267039:web:339e9fd49e3ad31f7423ea"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ---------- DOM REFS (preserve your IDs) ----------
const productImg=document.getElementById('productImg');
const productName=document.getElementById('productName');
const productDescription=document.getElementById('productDescription');
const productPrice=document.getElementById('productPrice');
const quantityBadge=document.getElementById('quantityBadge');
const addCartBtn=document.getElementById('addCartBtn');
const minusBtn=document.getElementById('minus');
const plusBtn=document.getElementById('plus');
const cartCountElem=document.getElementById('cartCount');
const customizeBtn=document.getElementById('customizeBtn');
const thumbnailContainer=document.getElementById('thumbnailContainer');
const colorOptions=document.getElementById('colorOptions');
const sizeOptions=document.getElementById('sizeOptions');
const headerEl=document.querySelector('.site-header');
const hamburger=document.getElementById('hamburger');
const headerRight=document.querySelector('.header-right');
const optionModal=document.getElementById('optionModal');
const closeModalBtn=document.getElementById('closeModalBtn');
const backToShopButton = document.getElementById('backToShop'); // single back button element (must exist in your markup)

// keys used on shop page
const STORAGE_KEY='seracCart';
const CURRENCY_KEY='seracCurrency';

// ---------- CART FUNCTIONS ----------
function getCart(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEY))||[]; } catch(e){ return []; } }
function setCart(cart){ try { localStorage.setItem(STORAGE_KEY,JSON.stringify(cart)); } catch(e){}; updateCartCount(); }
function updateCartCount(){ if(cartCountElem) cartCountElem.textContent=getCart().reduce((sum,i)=>sum+Number(i.quantity||0),0); }
function variantIdFor(productId, color, size){
  const parts=[productId];
  if(color) parts.push(String(color).replace(/\s+/g,'_'));
  if(size) parts.push(String(size).replace(/\s+/g,'_'));
  return parts.join('-');
}

function updateQuantityUI(productId){
  const sel = { color: colorOptions?.querySelector('.selected')?.textContent || '', size: sizeOptions?.querySelector('.selected')?.textContent || '' };
  const vid = variantIdFor(productId, sel.color, sel.size);
  const total = getCart().filter(i => String(i.id) === String(vid)).reduce((s,i)=>s + Number(i.quantity||0), 0);
  if(quantityBadge) quantityBadge.textContent = total || '';
  if(addCartBtn) addCartBtn.style.display = total > 0 ? 'none' : 'block';
}

// add and remove
function addToCart(product){
  let cart = getCart();
  const idx = cart.findIndex(i => i.id === product.id && (i.color||'') === (product.color||'') && (i.size||'') === (product.size||''));
  if(idx > -1) cart[idx].quantity = (Number(cart[idx].quantity)||0) + 1;
  else cart.push({...product, quantity:1});
  setCart(cart);
  updateQuantityUI(product.originalProductId || product.id);
}
function removeFromCart(productId, selColor='', selSize=''){
  let cart = getCart();
  const vid = variantIdFor(productId, selColor, selSize);
  const idx = cart.findIndex(i => String(i.id) === String(vid));
  if(idx > -1){
    cart[idx].quantity = (Number(cart[idx].quantity)||0) - 1;
    if(cart[idx].quantity <= 0) cart.splice(idx,1);
    setCart(cart);
  }
  updateQuantityUI(productId);
}

// ---------- CURRENCY HELPERS ----------
function getSelectedCurrency(){
  try { return localStorage.getItem(CURRENCY_KEY) || null; } catch(e){ return null; }
}
function setPriceText(elem, amount, currency){
  if(!elem) return;
  const displayCurrency = currency || getSelectedCurrency() || 'NGN';
  const localeMap = { NGN:'en-NG', USD:'en-US', EUR:'de-DE', GBP:'en-GB' };
  const minFrac = displayCurrency === 'NGN' ? 0 : 2;
  try { elem.textContent = new Intl.NumberFormat(localeMap[displayCurrency]||'en-US', { style:'currency', currency:displayCurrency, minimumFractionDigits:minFrac }).format(Number(amount||0)); }
  catch(e){ elem.textContent = `${displayCurrency} ${Number(amount||0).toFixed(minFrac)}`; }
}

// ---------- SELECTION HELPERS ----------
function getSelectedOptions(){ return { color: colorOptions?.querySelector('.selected')?.textContent || '', size: sizeOptions?.querySelector('.selected')?.textContent || '' }; }
function validateSelection(){
  const sel = getSelectedOptions();
  const needsColor = colorOptions && colorOptions.children.length > 0;
  const needsSize = sizeOptions && sizeOptions.children.length > 0;
  if((needsColor && !sel.color) || (needsSize && !sel.size)){ if(optionModal) optionModal.style.display = 'flex'; return false; }
  return true;
}

// ---------- LOAD PRODUCT ----------
const urlParams = new URLSearchParams(window.location.search);
const productId = urlParams.get('productId');
const urlPrice = parseFloat(urlParams.get('price'));
const urlCurrency = urlParams.get('currency');
let currentProductData = null;

async function loadProduct(){
  if(!productId) return;
  try{
    const docRef = doc(db, "brands", "serac", "products", productId);
    const docSnap = await getDoc(docRef);
    if(!docSnap.exists()){
      const pc = document.getElementById('productContainer');
      if(pc) pc.innerHTML = '<p style="text-align:center;color:#d9534f;">Product not found.</p>';
      return;
    }
    const data = docSnap.data();
    currentProductData = data;

    // images: preserve original logic / layout
    const images = Array.isArray(data.images) && data.images.length ? data.images.filter(Boolean) : (data.imageUrl ? [data.imageUrl] : []);
    if(productImg) productImg.src = images[0] || '';
    if(thumbnailContainer) {
      thumbnailContainer.innerHTML = '';
      images.forEach((imgUrl, idx) => {
        if(!imgUrl) return;
        const t = document.createElement('img');
        t.src = imgUrl;
        if(idx === 0) t.classList.add('selected');
        t.addEventListener('click', () => {
          if(productImg) productImg.src = imgUrl;
          thumbnailContainer.querySelectorAll('img').forEach(i => i.classList.remove('selected'));
          t.classList.add('selected');
        });
        thumbnailContainer.appendChild(t);
      });
    }

    if(productName) productName.textContent = data.name || '';
    if(productDescription) productDescription.textContent = data.description || '';

    // currency selection priority: url -> localStorage (shop) -> product data -> NGN
    const currencyFromStorage = getSelectedCurrency();
    const displayCurrency = urlCurrency || currencyFromStorage || data.currency || 'NGN';
    const displayPrice = !isNaN(urlPrice) ? urlPrice : (data.price || data.priceNGN || 0);
    setPriceText(productPrice, displayPrice, displayCurrency);
    currentProductData.price = displayPrice;
    currentProductData.currency = displayCurrency;

    // customization button
    if(data.customizationAvailable){
      if(customizeBtn){ customizeBtn.style.display = 'inline-block'; customizeBtn.href = `customization.html?productId=${productId}`; }
    } else { if(customizeBtn) customizeBtn.style.display = 'none'; }

    // Build options with clear separators (only insert label if options exist)
    if(colorOptions){
      colorOptions.innerHTML = '';
      const parent = colorOptions.parentElement;
      // remove previous label if present
      const existingLabel = parent?.querySelector('.variant-label');
      if(existingLabel) existingLabel.remove();
      if(Array.isArray(data.colors) && data.colors.length){
        const lbl = document.createElement('div'); lbl.className = 'variant-label'; lbl.textContent = 'Choose Color';
        parent?.insertBefore(lbl, colorOptions);
        data.colors.forEach(c => {
          const btn = document.createElement('button');
          btn.textContent = c;
          btn.addEventListener('click', () => {
            Array.from(colorOptions.children).forEach(b=>b.classList.remove('selected'));
            btn.classList.add('selected');
            updateQuantityUI(productId);
          });
          colorOptions.appendChild(btn);
        });
      }
    }

    if(sizeOptions){
      sizeOptions.innerHTML = '';
      const parent = sizeOptions.parentElement;
      const existingLabel = parent?.querySelector('.variant-label');
      if(existingLabel) existingLabel.remove();
      if(Array.isArray(data.sizes) && data.sizes.length){
        const lbl = document.createElement('div'); lbl.className = 'variant-label'; lbl.textContent = 'Choose Size';
        parent?.insertBefore(lbl, sizeOptions);
        data.sizes.forEach(s => {
          const btn = document.createElement('button');
          btn.textContent = s;
          btn.addEventListener('click', () => {
            Array.from(sizeOptions.children).forEach(b=>b.classList.remove('selected'));
            btn.classList.add('selected');
            updateQuantityUI(productId);
          });
          sizeOptions.appendChild(btn);
        });
      }
    }

    updateQuantityUI(productId);
  } catch(err){
    console.error(err);
    const pc = document.getElementById('productContainer');
    if(pc) pc.innerHTML = '<p style="text-align:center;color:#d9534f;">Failed to load product.</p>';
  }
}

// ---------- BUTTON EVENTS ----------
addCartBtn?.addEventListener('click', () => {
  if(!currentProductData) return;
  const hasVariant = (Array.isArray(currentProductData.colors) && currentProductData.colors.length) || (Array.isArray(currentProductData.sizes) && currentProductData.sizes.length);
  if(hasVariant && !validateSelection()) return;
  const sel = getSelectedOptions();
  const id = variantIdFor(productId, sel.color, sel.size);
  addToCart({
    id,
    originalProductId: productId,
    name: currentProductData.name,
    price: currentProductData.price,
    currency: currentProductData.currency,
    imageUrl: productImg?.src || '',
    color: sel.color,
    size: sel.size
  });
});

plusBtn?.addEventListener('click', () => {
  if(!currentProductData) return;
  const hasVariant = (Array.isArray(currentProductData.colors) && currentProductData.colors.length) || (Array.isArray(currentProductData.sizes) && currentProductData.sizes.length);
  if(hasVariant && !validateSelection()) return;
  const sel = getSelectedOptions();
  const id = variantIdFor(productId, sel.color, sel.size);
  addToCart({
    id,
    originalProductId: productId,
    name: currentProductData.name,
    price: currentProductData.price,
    currency: currentProductData.currency,
    imageUrl: productImg?.src || '',
    color: sel.color,
    size: sel.size
  });
});

minusBtn?.addEventListener('click', () => {
  const sel = getSelectedOptions();
  removeFromCart(productId, sel.color, sel.size);
});

// close option modal
closeModalBtn?.addEventListener('click', ()=> { if(optionModal) optionModal.style.display='none'; });

// ---------- THUMBNAIL DRAG (restored) ----------
let isDown=false, startX, scrollLeft;
if(thumbnailContainer){
  thumbnailContainer.addEventListener('mousedown',e=>{ isDown=true; startX=e.pageX-thumbnailContainer.offsetLeft; scrollLeft=thumbnailContainer.scrollLeft; });
  thumbnailContainer.addEventListener('mouseleave',()=>{ isDown=false; });
  thumbnailContainer.addEventListener('mouseup',()=>{ isDown=false; });
  thumbnailContainer.addEventListener('mousemove',e=>{ if(!isDown)return; e.preventDefault(); const x=e.pageX-thumbnailContainer.offsetLeft; thumbnailContainer.scrollLeft=scrollLeft-(x-startX)*2; });
}

// ---------- STORAGE SYNC ----------
window.addEventListener('storage', ()=>{ updateCartCount(); updateQuantityUI(productId); });

// ---------- HEADER / HAMBURGER / SCROLL BEHAVIOR (RESTORED EXACTLY FROM YOUR ORIGINAL) ----------
(function headerHeroBehavior(){
  const heroEl = document.querySelector('.hero') || document.getElementById('heroSection') || document.querySelector('.hero-about');
  if(!headerEl || !heroEl) return;

  let lastY = window.scrollY || 0;
  let hidden = false;
  let heroHeight = Math.round(heroEl.getBoundingClientRect().height);
  let hoverShown = false;

  function isMenuOpen(){
    return hamburger && hamburger.classList.contains('open');
  }

  function handleScroll(){
    const y = window.scrollY || 0;
    const menuOpen = isMenuOpen();

    // turn header dark after hero
    if(y > Math.max(50, heroHeight - 80))
      headerEl.classList.add('scrolled');
    else
      headerEl.classList.remove('scrolled');

    // if hamburger menu open, force header visible
    if(menuOpen){
      headerEl.style.top = '0';
      headerEl.style.opacity = '1';
      headerEl.style.pointerEvents = 'auto';
      return;
    }

    if(y > heroHeight - 80){
      if(y > lastY && !hidden){
        headerEl.style.top = '-90px';
        headerEl.style.opacity = '0';
        headerEl.style.pointerEvents = 'none';
        hidden = true;
      } else if(y < lastY && hidden){
        headerEl.style.top = '0';
        headerEl.style.opacity = '1';
        headerEl.style.pointerEvents = 'auto';
        headerEl.classList.add('scrolled');
        hidden = false;
      }
    } else {
      headerEl.style.top = '0';
      headerEl.style.opacity = '1';
      headerEl.style.pointerEvents = 'auto';
      headerEl.classList.remove('scrolled');
      hidden = false;
    }

    lastY = y;
  }

  // hover reveal (disabled when menu open)
  document.addEventListener('mousemove', (e) => {
    if(isMenuOpen()) return;

    if(e.clientY < 100){
      if(hidden){
        headerEl.style.top = '0';
        headerEl.style.opacity = '1';
        headerEl.style.pointerEvents = 'auto';
        headerEl.classList.add('scrolled');
        hidden = false;
        hoverShown = true;
      }
    } else if(hoverShown){
      setTimeout(()=>{
        if(window.scrollY > heroHeight - 80 && !isMenuOpen()){
          headerEl.style.top = '-90px';
          headerEl.style.opacity = '0';
          headerEl.style.pointerEvents = 'none';
          hidden = true;
        }
        hoverShown = false;
      }, 220);
    }
  });

  if(hamburger){
    hamburger.addEventListener('click', () => {
      const expandedNow = hamburger.classList.toggle('open');
      headerRight.classList.toggle('open', expandedNow);
      hamburger.setAttribute('aria-expanded', expandedNow);
      setTimeout(handleScroll, 200);
    });
  }

  window.addEventListener('resize', () => {
    heroHeight = Math.round(heroEl.getBoundingClientRect().height);
    handleScroll();
  }, { passive: true });

  window.addEventListener('scroll', handleScroll, { passive: true });
  window.addEventListener('load', () => {
    heroHeight = Math.round(heroEl.getBoundingClientRect().height);
    handleScroll();
  });
})();

// ---------- SMOOTH SCROLL (closes mobile menu on click) ----------
document.querySelectorAll('.header-right a').forEach(link => {
  link.addEventListener('click', e => {
    const href = link.getAttribute('href');
    if (href && href.startsWith('#')) {
      e.preventDefault();
      const target = document.getElementById(href.slice(1));
      if (target) {
        window.scrollTo({ top: target.offsetTop - 80, behavior: 'smooth' });
      }
    }
    if (headerRight && hamburger) {
      headerRight.classList.remove('open');
      hamburger.classList.remove('open');
      hamburger.setAttribute('aria-expanded', 'false');
    }
  });
});

// ---------- STICKY BACK BEHAVIOR (single back button; prevents footer collision) ----------
function initBackButtonCollisionAvoidance(){
  const btn = backToShopButton;
  if(!btn) return;
  const footer = document.querySelector('footer');
  const baseBottom = 20;
  btn.style.bottom = `${baseBottom}px`;

  if(!footer) return;
  const io = new IntersectionObserver(entries => {
    entries.forEach(en => {
      if(en.isIntersecting){
        // raise the back button by footer height + margin
        btn.style.bottom = `${baseBottom + Math.ceil(en.intersectionRect.height) + 12}px`;
      } else {
        btn.style.bottom = `${baseBottom}px`;
      }
    });
  }, { root: null, threshold: 0 });

  io.observe(footer);
}

// ---------- INIT ----------
updateCartCount();
loadProduct();
initBackButtonCollisionAvoidance();
</script>
  
</body>
</html>
  


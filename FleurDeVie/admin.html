<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fleur De Vie Admin Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing:border-box; margin:0; padding:0; }
    body { font-family: "Montserrat", sans-serif; background:#F5E6CC; color:#112e1f; line-height:1.6; }
    a { text-decoration:none; color:inherit; }

    header { background:#112e1f; color:#FFD6BA; padding:16px; text-align:center; font-family:"Playfair Display", serif; font-size:24px; font-weight:700; }

    .container { max-width:1000px; margin:2rem auto; padding:2rem; background:#FFD6BA; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }

    h2 { font-family:"Playfair Display", serif; margin-bottom:16px; color:#112e1f; }

    label { display:block; margin-top:1rem; font-weight:500; }
    input, textarea, select { width:100%; padding:0.6rem; margin-top:0.5rem; border:1px solid #112e1f; border-radius:6px; font-size:1rem; }

    button { margin-top:1rem; padding:0.75rem 1.2rem; background:#112e1f; color:#FFD6BA; border:none; border-radius:6px; cursor:pointer; font-weight:600; transition:0.3s; }
    button:hover { background:#0a1d14; }

    .message { margin-top:1rem; font-weight:500; font-size:1rem; text-align:center; }

    table { width:100%; border-collapse:collapse; margin-top:1.5rem; background:#fff; border-radius:12px; overflow:hidden; }
    th, td { padding:0.75rem; border-bottom:1px solid #ddd; text-align:left; font-size:0.95rem; vertical-align:top; }
    th { background:#F5E6CC; font-family:"Playfair Display", serif; color:#112e1f; }
    td img { width:60px; border-radius:6px; }

    .actions button { margin-right:0.5rem; padding:0.4rem 0.6rem; font-size:0.9rem; }
    .actions button:hover { opacity:0.85; }

    .small-note { font-size:0.9rem; color:#334d3a; margin-top:8px; }

    /* Dashboard Navigation */
    .dashboard-nav { display:flex; gap:10px; margin-bottom:1.5rem; }
    .dashboard-nav button { flex:1; }
    .section { display:none; margin-top:1rem; }
    .section.active { display:block; }

    .details-row { background:#fff6e8; }
    .details-row td { padding:12px; }

    @media(max-width:600px){
      .container { padding:1rem; }
      table, th, td { font-size:0.85rem; }
      th, td { padding:0.5rem; }
      .dashboard-nav { flex-direction:column; }
    }
  </style>
</head>
<body>

  <header>Fleur De Vie Admin Dashboard</header>

  <!-- LOGIN FORM -->
  <div class="container" id="loginContainer">
    <h2>Admin Login</h2>
    <form id="loginForm">
      <label for="loginEmail">Email</label>
      <input type="email" id="loginEmail" required>

      <label for="loginPassword">Password</label>
      <input type="password" id="loginPassword" required>

      <button type="submit">Login</button>
      <div class="message" id="loginMessage"></div>
    </form>
  </div>

  <!-- DASHBOARD -->
  <div class="container" id="dashboardContainer" style="display:none;">
    <div class="dashboard-nav">
      <button type="button" data-target="productsSection">ðŸ“¦ Products</button>
      <button type="button" data-target="quotesSection">ðŸ’³ Quotes</button>
      <button type="button" data-target="ordersSection">ðŸ§¾ Orders</button>
    </div>

    <!-- PRODUCTS -->
    <div class="section" id="productsSection">
      <h2>Manage Products</h2>
      <form id="productForm">
        <label>Name</label>
        <input type="text" id="productName" required>
        <label>Price</label>
        <input type="number" id="productPrice" required>
        <label>Description</label>
        <textarea id="productDesc"></textarea>
        <label>Image URL</label>
        <input type="text" id="productImg">
        <label>Customization Available</label>
        <select id="productCustom">
          <option value="false">No</option>
          <option value="true">Yes</option>
        </select>
        <button type="submit">Add Product</button>
      </form>
      <div id="productMessage" class="message"></div>
      <table id="productsTable">
        <thead>
          <tr><th>Name</th><th>Price</th><th>Description</th><th>Image</th><th>Customization</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- QUOTES -->
    <div class="section" id="quotesSection">
      <h2>Generate Quote</h2>
      <form id="quoteForm">
        <label>Customer Name</label>
        <input type="text" id="quoteCustomer" required>
        <label>Customer Email</label>
        <input type="email" id="quoteEmail" required>

        <h3>Quote Items</h3>
        <div id="quoteItems"></div>
        <button type="button" id="addQuoteItem">+ Add Item</button>

        <label>Total</label>
        <input type="number" id="quoteTotal" required>

        <button type="submit">Save Quote</button>
      </form>
      <div id="quoteMessage" class="message"></div>
      <table id="quotesTable">
        <thead>
          <tr><th>Customer</th><th>Email</th><th>Total</th><th>Status</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- ORDERS -->
    <div class="section" id="ordersSection">
      <h2>Manage Orders</h2>
      <table id="ordersTable">
        <thead>
          <tr><th>Order ID</th><th>Customer</th><th>Email</th><th>Total</th><th>Status</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <button id="exportOrders">Export Orders CSV</button>
    </div>
  </div>

  <!-- FIREBASE & LOGIC -->
  <script type="module">
    // import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    // import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    // import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js"; 
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js"; 
    import { getFirestore, collection, addDoc, doc, updateDoc, deleteDoc, onSnapshot, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
    
    // const firebaseConfig = {
    //   apiKey: "YOUR_API_KEY",
    //   authDomain: "YOUR_AUTH_DOMAIN",
    //   projectId: "YOUR_PROJECT_ID",
    //   storageBucket: "YOUR_BUCKET",
    //   messagingSenderId: "YOUR_SENDER",
    //   appId: "YOUR_APP_ID"
    // };

    const firebaseConfig = { 
      apiKey: "AIzaSyCuiZXHFYl1fVKnGwojavRvbekSBpkipJg", 
      authDomain: "brandisby.firebaseapp.com", 
      projectId: "brandisby", 
      storageBucket: "brandisby.firebasestorage.app", 
      messagingSenderId: "87213267039", 
      appId: "1:87213267039:web:339e9fd49e3ad31f7423ea" 
    };

    // const app = initializeApp(firebaseConfig);
    // const auth = getAuth(app);
    // const db = getFirestore(app);

    const app = initializeApp(firebaseConfig); 
    const auth = getAuth(app); 
    const db = getFirestore(app);

    // const allowedAdmins = ["admin@example.com"];

    const allowedAdmins = ["yourstruly.fleurdevie@gmail.com"].map(e => e.toLowerCase().trim());

    const loginForm = document.getElementById("loginForm");
    const loginMessage = document.getElementById("loginMessage");
    const loginContainer = document.getElementById("loginContainer");
    const dashboardContainer = document.getElementById("dashboardContainer");

    loginForm.addEventListener("submit", async (e)=>{
      e.preventDefault();
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;
      try {
        const userCred = await signInWithEmailAndPassword(auth,email,password);
        if(allowedAdmins.includes(userCred.user.email)){
          loginContainer.style.display="none";
          dashboardContainer.style.display="block";
          loadProducts();
          loadQuotes();
          loadOrders();
        } else {
          loginMessage.textContent="Not authorized.";
          signOut(auth);
        }
      } catch(err){ loginMessage.textContent=err.message; }
    });

    // Tabs
    document.querySelectorAll(".dashboard-nav button").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        document.querySelectorAll(".section").forEach(sec=>sec.classList.remove("active"));
        document.getElementById(btn.dataset.target).classList.add("active");
      });
    });

    /* ---------------- PRODUCTS ---------------- */
    const productForm=document.getElementById("productForm");
    const productMessage=document.getElementById("productMessage");
    const productsTable=document.querySelector("#productsTable tbody");
    productForm.addEventListener("submit", async(e)=>{
      e.preventDefault();
      const data={
        name:document.getElementById("productName").value,
        price:+document.getElementById("productPrice").value,
        desc:document.getElementById("productDesc").value,
        img:document.getElementById("productImg").value,
        custom:document.getElementById("productCustom").value==="true"
      };
      await addDoc(collection(db,"products"),data);
      productMessage.textContent="Product added.";
      loadProducts();
      productForm.reset();
    });
    async function loadProducts(){
      productsTable.innerHTML="";
      const snap=await getDocs(collection(db,"products"));
      snap.forEach(docSnap=>{
        const p=docSnap.data();
        const row=document.createElement("tr");
        row.innerHTML=`
          <td>${p.name}</td>
          <td>${p.price}</td>
          <td>${p.desc}</td>
          <td><img src="${p.img}"/></td>
          <td>${p.custom?"Yes":"No"}</td>
          <td class="actions">
            <button onclick="deleteProduct('${docSnap.id}')">Delete</button>
          </td>`;
        productsTable.appendChild(row);
      });
    }
    window.deleteProduct=async(id)=>{ await deleteDoc(doc(db,"products",id)); loadProducts(); };

    /* ---------------- QUOTES ---------------- */
    const quoteForm=document.getElementById("quoteForm");
    const quoteMessage=document.getElementById("quoteMessage");
    const quotesTable=document.querySelector("#quotesTable tbody");
    const quoteItemsDiv=document.getElementById("quoteItems");
    document.getElementById("addQuoteItem").addEventListener("click",()=>{
      const div=document.createElement("div");
      div.innerHTML=`
        <label>Item Name</label><input type="text" class="qi-name">
        <label>Qty</label><input type="number" class="qi-qty">
        <label>Price</label><input type="number" class="qi-price">
        <label>Description</label><input type="text" class="qi-desc">`;
      quoteItemsDiv.appendChild(div);
    });
    quoteForm.addEventListener("submit", async(e)=>{
      e.preventDefault();
      const items=[...document.querySelectorAll("#quoteItems div")].map(div=>({
        name:div.querySelector(".qi-name").value,
        qty:+div.querySelector(".qi-qty").value,
        price:+div.querySelector(".qi-price").value,
        desc:div.querySelector(".qi-desc").value
      }));
      const data={
        customer:document.getElementById("quoteCustomer").value,
        email:document.getElementById("quoteEmail").value,
        items,
        total:+document.getElementById("quoteTotal").value,
        status:"Pending"
      };
      await addDoc(collection(db,"quotes"),data);
      quoteMessage.textContent="Quote saved.";
      loadQuotes();
      quoteForm.reset(); quoteItemsDiv.innerHTML="";
    });
    async function loadQuotes(){
      quotesTable.innerHTML="";
      const snap=await getDocs(collection(db,"quotes"));
      snap.forEach(docSnap=>{
        const q=docSnap.data();
        const row=document.createElement("tr");
        row.innerHTML=`<td>${q.customer}</td><td>${q.email}</td><td>${q.total}</td><td>${q.status}</td><td></td>`;
        quotesTable.appendChild(row);
      });
    }

    /* ---------------- ORDERS ---------------- */
    const ordersTable=document.querySelector("#ordersTable tbody");
    document.getElementById("exportOrders").addEventListener("click", exportOrdersCSV);

    async function loadOrders(){
      ordersTable.innerHTML="";
      const snap=await getDocs(collection(db,"orders"));
      snap.forEach(docSnap=>{
        const o=docSnap.data();
        const row=document.createElement("tr");
        row.innerHTML=`
          <td>${docSnap.id}</td>
          <td>${o.customer||""}</td>
          <td>${o.email||""}</td>
          <td>${o.total||0}</td>
          <td>
            <select onchange="updateOrderStatus('${docSnap.id}',this.value)">
              <option ${o.status==="Pending"?"selected":""}>Pending</option>
              <option ${o.status==="Paid"?"selected":""}>Paid</option>
              <option ${o.status==="Processing"?"selected":""}>Processing</option>
              <option ${o.status==="Shipped"?"selected":""}>Shipped</option>
              <option ${o.status==="Completed"?"selected":""}>Completed</option>
              <option ${o.status==="Cancelled"?"selected":""}>Cancelled</option>
            </select>
          </td>
          <td><button onclick="toggleDetails(this)">Details</button></td>
        `;
        ordersTable.appendChild(row);
        const details=document.createElement("tr");
        details.classList.add("details-row");
        details.style.display="none";
        let itemsHTML="";
        (o.items||[]).forEach(it=>{
          itemsHTML+=`<div>${it.name} x${it.qty} @ ${it.price} = ${it.qty*it.price}</div>`;
        });
        details.innerHTML=`<td colspan="6"><strong>Items:</strong><br>${itemsHTML}<br><strong>Address:</strong> ${o.address||""}</td>`;
        ordersTable.appendChild(details);
      });
    }
    window.toggleDetails=(btn)=>{
      const detailsRow=btn.parentElement.parentElement.nextElementSibling;
      detailsRow.style.display=detailsRow.style.display==="none"?"table-row":"none";
    };
    window.updateOrderStatus=async(id,status)=>{ await updateDoc(doc(db,"orders",id),{status}); loadOrders(); };

    async function exportOrdersCSV(){
      const snap=await getDocs(collection(db,"orders"));
      let csv="OrderID,Customer,Email,Status,Item,Qty,Price,Subtotal\n";
      snap.forEach(docSnap=>{
        const o=docSnap.data();
        (o.items||[]).forEach(it=>{
          csv+=`${docSnap.id},${o.customer||""},${o.email||""},${o.status||""},${it.name},${it.qty},${it.price},${it.qty*it.price}\n`;
        });
      });
      const blob=new Blob([csv],{type:"text/csv"});
      const link=document.createElement("a");
      link.href=URL.createObjectURL(blob);
      link.download="orders.csv";
      link.click();
    }
  </script>
</body>
</html>

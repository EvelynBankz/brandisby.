<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thank You - Fleur De Vie</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:"Montserrat",sans-serif;background:#F5E6CC;color:#112e1f;line-height:1.6;text-align:center}
    a{text-decoration:none;color:inherit}

    .site-header{background:#112e1f;color:#F5E6CC;display:flex;justify-content:space-between;align-items:center;padding:16px 28px;position:fixed;top:0;left:0;right:0;z-index:1000}
    .header-left{display:flex;align-items:center;gap:12px}
    .brand-logo{height:60px}
    .brand-title{font-family:"Playfair Display",serif;font-size:24px;font-weight:700}
    .header-right{display:flex;gap:20px;align-items:center}
    .header-right a{font-weight:500;transition:color .3s}
    .header-right a:hover{color:#FFD6BA}
    .hamburger{display:none;background:none;border:none;cursor:pointer;width:30px;height:24px;position:relative}
    .hamburger span{display:block;width:100%;height:3px;background:#F5E6CC;border-radius:2px;position:absolute;left:0;transition:0.3s}
    .hamburger span:nth-child(1){top:0}
    .hamburger span:nth-child(2){top:10px}
    .hamburger span:nth-child(3){top:20px}
    .hamburger.open span:nth-child(1){transform:rotate(45deg);top:10px}
    .hamburger.open span:nth-child(2){opacity:0}
    .hamburger.open span:nth-child(3){transform:rotate(-45deg);top:10px}

    .hero{position:relative;height:90vh;display:flex;justify-content:center;align-items:center;text-align:center;margin-top:80px;overflow:hidden}
    .hero::after{content:"";position:absolute;inset:0;background:url('asset/bg2.jpg') center/cover no-repeat;transform:scale(1.1);z-index:-1;border-radius:12px;box-shadow:inset 0 0 0 2000px rgba(17,46,31,0.3)}
    .hero-text{position:relative;display:inline-block;color:#FFD6BA}
    .hero-text h1{font-family:"Playfair Display",serif;font-size:clamp(32px,5vw,56px)}

    .thankyou-section{padding:80px 20px}
    .thankyou-box{background:#FFD6BA;padding:40px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.15);max-width:700px;margin:auto}
    .thankyou-box h2{font-family:"Playfair Display",serif;font-size:28px;margin-bottom:20px}
    .thankyou-box p{font-size:18px;margin-bottom:24px}
    .order-details{text-align:left;margin-top:20px}
    .order-details h3{margin-bottom:10px;font-family:"Playfair Display",serif}
    .order-details ul{list-style:none;padding:0;margin:0}
    .order-details li{margin-bottom:8px;font-size:16px}
    .btn{display:inline-block;padding:14px 28px;border-radius:8px;font-weight:600;transition:0.3s}
    .btn-primary{background:#112e1f;color:#F5E6CC;border:none}
    .btn-primary:hover{background:#0a1d14}
    .btn-secondary{background:#fff;color:#112e1f;border:2px solid #112e1f;margin-left:10px}
    .btn-secondary:hover{background:#112e1f;color:#FFD6BA}

    footer{text-align:center;padding:20px;background:#112e1f;color:#F5E6CC;margin-top:60px}

    @media(max-width:800px){
      .header-right{display:none;flex-direction:column;position:absolute;top:70px;right:0;background:#112e1f;width:200px;padding:20px}
      .header-right.open{display:flex}
      .hamburger{display:block}
      .thankyou-box{padding:20px}
    }

    /* ---------- Overlay with animated gradient ---------- */
    #fleur-overlay{
      position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;
      background: linear-gradient(-45deg,#f7dad9,#112e1f,#e6daf6,#f7dad9);
      background-size:400% 400%;
      animation:gradientShift 10s ease infinite;
      transition:opacity .45s ease;opacity:1;
    }
    @keyframes gradientShift{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    .fleur-spinner{
      width:70px;height:70px;border-radius:50%;
      border:7px solid rgba(255,255,255,0.18);
      border-top-color:#112e1f;
      animation:spin 1s linear infinite;
      box-shadow:0 8px 28px rgba(0,0,0,0.35);
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* ---------- Toast ---------- */
    .fleur-toast{
      position:fixed;left:50%;bottom:36px;transform:translateX(-50%);
      background:#112e1f;color:#fff;padding:10px 14px;border-radius:8px;
      font-weight:600;z-index:10001;opacity:0;pointer-events:none;
      transition:opacity .2s ease,transform .2s ease;
      box-shadow:0 8px 30px rgba(17,46,31,0.6)
    }
    .fleur-toast.show{opacity:1;pointer-events:auto;transform:translateX(-50%) translateY(-6px)}
  </style>
</head>

<body>
  <!-- HEADER -->
  <header class="site-header">
    <div class="header-left">
      <img src="asset/logo.png" alt="Fleur De Vie Logo" class="brand-logo">
      <div class="brand-title">Fleur De Vie</div>
    </div>
    <nav class="header-right" id="headerRight">
      <a href="index.html">Home</a>
      <a href="shop.html">Shop</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
    </nav>
    <button class="hamburger" id="hamburger" aria-label="Menu"><span></span><span></span><span></span></button>
  </header>

  <!-- HERO -->
  <section class="hero"><div class="hero-text"><h1>Thank You</h1></div></section>

  <!-- THANK YOU SECTION -->
  <section class="thankyou-section">
    <div class="thankyou-box" id="thankyouBox">
      <h2>Weâ€™ve received your order ðŸŽ‰</h2>
      <p>Thank you for shopping with <strong>Fleur De Vie</strong>. Your order is being processed and youâ€™ll receive a confirmation email shortly.</p>

      <div id="orderReferenceBox" style="display:inline-block;margin:12px 0;padding:12px 18px;border-radius:10px;background:#fff;font-weight:700;cursor:pointer">Loading referenceâ€¦</div>
      <div id="orderReferenceNote" style="color:#334d3a;margin-bottom:12px"></div>

      <div class="order-details" id="orderDetails"><p>Loading order detailsâ€¦</p></div>

      <div style="margin-top:18px">
        <a href="shop.html" class="btn btn-primary">Continue Shopping</a>
        <a id="trackOrderBtn" href="trackorder.html" class="btn btn-secondary">Track Order</a>
      </div>
    </div>
  </section>

  <!-- Overlay + Spinner -->
  <div id="fleur-overlay"><div class="fleur-spinner"></div></div>

  <!-- Toast -->
  <div id="fleur-toast" class="fleur-toast">Copied.</div>

  <!-- Floating Support Button -->
  <button id="floatingSupportBtn" aria-label="Support" 
    style="position:fixed;right:22px;bottom:22px;width:60px;height:60px;border-radius:50%;
    border:none;background:#112e1f;color:#fff;z-index:10002;
    box-shadow:0 8px 30px rgba(212,245,105,1);cursor:pointer;display:flex;
    align-items:center;justify-content:center;">
    <i class="fa-solid fa-headset" style="color:#fff;font-size:28px;"></i>
  </button>

  <footer>Â© 2025 Fleur De Vie</footer>

  <script type="module">
    // Hamburger toggle
    const hamburger=document.getElementById('hamburger');
    const headerRight=document.getElementById('headerRight');
    hamburger?.addEventListener('click',()=>{hamburger.classList.toggle('open');headerRight.classList.toggle('open');});

    // Floating support toggle
    const supportBtn=document.getElementById('floatingSupportBtn');
    supportBtn?.addEventListener('click',()=>{window.location.href='mailto:yourstruly.fleurdevie@gmail.com?subject=Support%20Request';});

    // Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, doc, getDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    const firebaseConfig={
      apiKey:"AIzaSyCuiZXHFYl1fVKnGwojavRvbekSBpkipJg",
      authDomain:"brandisby.firebaseapp.com",
      projectId:"brandisby",
      storageBucket:"brandisby.firebasestorage.app",
      messagingSenderId:"87213267039",
      appId:"1:87213267039:web:339e9fd49e3ad31f7423ea"
    };
    const app=initializeApp(firebaseConfig);
    const db=getFirestore(app);

    const overlay=document.getElementById('fleur-overlay');
    const toast=document.getElementById('fleur-toast');

    function fadeRemoveOverlay(){overlay.style.opacity='0';setTimeout(()=>overlay.remove(),500);}
    let toastTimer=null;
    function showCopiedToast(){
      toast.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer=setTimeout(()=>toast.classList.remove('show'),1400);
    }
    function safeParseJSON(v){try{return JSON.parse(v||'null');}catch(e){return null;}}
    function escapeHtml(s){if(s==null)return'';return String(s).replace(/[&<>"']/g,ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[ch]));}

    async function displayOrder(){
      const refBox=document.getElementById('orderReferenceBox');
      const note=document.getElementById('orderReferenceNote');
      const details=document.getElementById('orderDetails');
      const trackBtn=document.getElementById('trackOrderBtn');
      let order=safeParseJSON(localStorage.getItem('lastOrder_fleurdevie'))||safeParseJSON(localStorage.getItem('lastOrder'))||null;
      const params=new URLSearchParams(window.location.search);
      const orderId=params.get('orderId');
      const txref=params.get('txref')||params.get('ref');
      const quoteId=params.get('quoteId');

      try{
        if(!order && orderId){
          const snap=await getDoc(doc(db,"brands","fleurdevie","orders",orderId));
          if(snap.exists())order={id:orderId,...snap.data()};
        }
        if(!order && txref){
          const snap=await getDoc(doc(db,"brands","fleurdevie","orders",txref));
          if(snap.exists())order={id:txref,...snap.data()};
          else{
            const q=query(collection(db,"brands","fleurdevie","orders"),where("trackingRef","==",txref));
            const snaps=await getDocs(q);
            if(!snaps.empty){const s=snaps.docs[0];order={id:s.id,...s.data()};}
          }
        }
        if(!order && (quoteId||safeParseJSON(localStorage.getItem('paidQuoteInfo'))?.quoteId)){
          const qid=quoteId||safeParseJSON(localStorage.getItem('paidQuoteInfo'))?.quoteId;
          const qsnap=await getDoc(doc(db,"brands","fleurdevie","quotes",qid));
          if(qsnap.exists()){
            const qd=qsnap.data();
            order={id:qid,type:'quote',trackingRef:qd.trackingRef||qd.orderRef,name:qd.name||qd.customer,email:qd.email,phone:qd.phone,address:qd.address,currency:qd.currency||'NGN',total:qd.total||qd.amount||qd.subtotal||0,items:qd.items||[]};
          }
        }
      }catch(e){console.error(e);}

      if(!order){
        refBox.textContent='No order reference available.';
        note.textContent='';
        details.innerHTML='<p>Unable to locate order details. Please refresh or contact support.</p>';
        trackBtn.style.display='none';
        fadeRemoveOverlay();
        return;
      }

      const ref=order.trackingRef||order.tracking||order.orderRef||order.id;
      refBox.textContent=ref;
      note.textContent='You can use this reference to track your order. Click to copy.';
      refBox.onclick=async()=>{await navigator.clipboard.writeText(ref);showCopiedToast();};

      const c=order.currency||'NGN', t=order.total??'-';
      let html=`<h3>Order Details</h3><ul>
        <li><strong>Name:</strong> ${escapeHtml(order.name)}</li>
        <li><strong>Email:</strong> ${escapeHtml(order.email)}</li>
        <li><strong>Phone:</strong> ${escapeHtml(order.phone)}</li>
        <li><strong>Address:</strong> ${escapeHtml(order.address)}</li>
        <li><strong>Currency:</strong> ${escapeHtml(c)}</li>
        <li><strong>Total Paid:</strong> ${escapeHtml(c)} ${escapeHtml(t)}</li>
      </ul><h3>Items</h3><ul>`;
      (order.items||[]).forEach(i=>{html+=`<li>${escapeHtml(i.name||'Item')} (x${escapeHtml(i.quantity||1)})</li>`;});
      html+='</ul>';details.innerHTML=html;

      const sendEmailBtn=document.createElement('button');
      sendEmailBtn.className='btn btn-secondary';
      sendEmailBtn.textContent='Send to my email';
      sendEmailBtn.style.marginTop='12px';
      sendEmailBtn.onclick=()=>{const subject=encodeURIComponent('Your Fleur De Vie Order Confirmation');
        const body=encodeURIComponent(`Hello ${order.name||''},\n\nThank you for shopping with Fleur De Vie.\n\nOrder reference: ${ref}\nTotal: ${c} ${t}\n\nTrack here: ${window.location.origin}/trackorder.html\n\nRegards,\nFleur De Vie`);
        window.location.href=`mailto:${order.email}?subject=${subject}&body=${body}`;};
      document.getElementById('thankyouBox').insertBefore(sendEmailBtn,details);
      fadeRemoveOverlay();
    }

    document.addEventListener('DOMContentLoaded',()=>{displayOrder();});
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sérac - Shop</title>

<!-- Fonts: Montserrat (body) + Playfair Display (headlines) -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* Theme variables */
:root{
  --bg-dark: #141517;
  --bg-mid: #4B4E54;
  --gold: #B66E41;
  --muted: #bdbdbd;
  --surface: #1b1c1d;
  --card-bg: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  --radius: 12px;
  --transition: 220ms cubic-bezier(.2,.9,.2,1);
  --accent-strong: rgba(182,110,65,0.95);
}

/* RESET & HEADER */
* { margin:0; padding:0; box-sizing:border-box; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
body { font-family: "Montserrat", sans-serif; background: var(--bg-dark); color: #e6e6e6; line-height:1.6; -webkit-font-smoothing:antialiased; }
a { text-decoration:none; color:inherit; }

/* Header */
.site-header { background: linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.25)); color: #e6e6e6; display:flex; justify-content:space-between; align-items:center; padding:18px 28px; position:fixed; top:0; left:0; right:0; z-index:1000; border-bottom:1px solid rgba(255,255,255,0.03); backdrop-filter: blur(6px); }
.header-left { display:flex; align-items:center; gap:14px; }
.brand-logo { height:60px; width:auto; object-fit:contain; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.6)); }
.brand-title { font-family:"Playfair Display", serif; font-size:24px; font-weight:700; color:var(--gold); letter-spacing:0.6px; }

/* Header right links */
.header-right { display:flex; gap:22px; align-items:center; }
.header-right a { font-weight:500; color:var(--muted); padding:6px 8px; border-radius:8px; transition: color var(--transition), transform var(--transition); }
.header-right a:hover { color: #fff; transform:translateY(-2px); text-shadow: 0 4px 18px rgba(182,110,65,0.15); }
.cart-count { background:var(--gold); color:var(--bg-dark); font-size:12px; font-weight:700; border-radius:50%; padding:3px 7px; margin-left:6px; box-shadow:0 4px 10px rgba(182,110,65,0.12); }

/* Hamburger */
.hamburger { display:none; background:none; border:none; cursor:pointer; width:34px; height:26px; position:relative; }
.hamburger span { display:block; width:100%; height:3px; background:var(--muted); border-radius:3px; position:absolute; left:0; transition: all 200ms ease; }
.hamburger span:nth-child(1){ top:0; }
.hamburger span:nth-child(2){ top:11px; width:70%; }
.hamburger span:nth-child(3){ top:22px; }
.hamburger.open span:nth-child(1){ transform:rotate(45deg); top:11px; background:var(--gold); }
.hamburger.open span:nth-child(2){ opacity:0; }
.hamburger.open span:nth-child(3){ transform:rotate(-45deg); top:11px; background:var(--gold); }

/* HERO */
.hero { position: relative; height:90vh; display:flex; justify-content:center; align-items:center; text-align:center; margin-top:82px; overflow:hidden; padding:20px; }
.hero::after { content:""; position:absolute; inset:0; background: url('asset/bg24.jpg') center/cover no-repeat; transform: scale(1.05); z-index:-1; mix-blend-mode: multiply; border-radius:14px; box-shadow: inset 0 0 0 1200px rgba(20,21,23,0.55); filter: contrast(0.95) saturate(0.85); }
.hero-text { position:relative; display:inline-block; color:var(--gold); margin-bottom:12px; padding:18px 26px; border-radius:10px; background: linear-gradient(90deg, rgba(182,110,65,0.06), rgba(255,255,255,0.01)); backdrop-filter: blur(2px); box-shadow: 0 10px 40px rgba(11,12,13,0.6); transition: transform var(--transition); }
.hero-text:hover{ transform: translateY(-6px); }
.hero-text h1 { font-family:"Playfair Display", serif; font-size:clamp(36px,5vw,64px); margin-bottom:10px; color:var(--gold); text-shadow: 0 6px 30px rgba(182,110,65,0.08); }
.hero-text p { font-size:clamp(15px,2vw,20px); max-width:760px; color: #d0c8c2; }

/* subtle shimmer (very gentle) */
@keyframes shimmer {
  0% { filter: brightness(1); transform: translateY(0); }
  50% { filter: brightness(1.02); transform: translateY(-2px); }
  100% { filter: brightness(1); transform: translateY(0); }
}
.hero-text { animation: shimmer 6s ease-in-out infinite; }

/* SEARCH + SORT + CURRENCY */
.shop-controls { display:flex; justify-content:space-between; flex-wrap:wrap; margin-bottom:24px; gap:12px; align-items:center; }
.shop-controls input,
.shop-controls select { padding:10px 12px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); font-size:14px; flex:1; max-width:320px; background:transparent; color:#e8e8e8; outline:none; box-shadow: inset 0 1px 0 rgba(255,255,255,0.01); transition: box-shadow var(--transition), transform var(--transition); }
.shop-controls input:focus, .shop-controls select:focus { box-shadow: 0 6px 28px rgba(182,110,65,0.06); transform: translateY(-2px); border-color: rgba(182,110,65,0.18); }
.currency-filter-group { display:flex; gap:10px; align-items:center; flex:1; max-width:360px; }

/* SHOP GRID section */
section.shop { padding:88px 20px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03)); }
.container { max-width:1100px; margin:auto; }
h2 { text-align:center; font-size:26px; font-family:"Playfair Display", serif; margin-bottom:36px; color:#fff; letter-spacing:0.2px; }

/* Product grid & cards */
.product-grid { display:grid; gap:22px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
.product-card { background: var(--card-bg); padding:16px; border-radius:var(--radius); box-shadow: 0 6px 24px rgba(2,2,2,0.6); display:flex; flex-direction:column; transition: transform var(--transition), box-shadow var(--transition); position:relative; color: #e6e6e6; border: 1px solid rgba(255,255,255,0.02); overflow:hidden; }
.product-card:hover { transform: translateY(-8px) scale(1.01); box-shadow: 0 14px 60px rgba(11,12,13,0.72); }
.product-card img { width:100%; height:180px; object-fit:contain; border-radius:8px; margin-bottom:12px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02)); display:block; padding:12px; }
.product-card h3 { font-family:"Playfair Display", serif; font-size:1.05rem; margin-bottom:6px; color:#fff; }
.product-card .description { font-size:0.9rem; color:#bfbfbf; margin-bottom:10px; min-height:40px; }
.product-card .price { font-weight:700; margin-bottom:12px; color:var(--gold); font-size:1rem; }
.product-card button { background:var(--gold); color:var(--bg-dark); border:none; border-radius:8px; padding:10px; cursor:pointer; transition: transform var(--transition), box-shadow var(--transition); box-shadow: 0 8px 24px rgba(182,110,65,0.12); font-weight:600; }
.product-card button:hover { transform: translateY(-3px); box-shadow: 0 18px 50px rgba(182,110,65,0.16); }

/* Quantity controls */
.quantity-controls { display:flex; gap:10px; align-items:center; margin-bottom:8px; }
.quantity-controls .minus, .quantity-controls .plus { background:transparent; border:1px solid rgba(255,255,255,0.04); color:#e6e6e6; padding:8px 10px; border-radius:8px; cursor:pointer; transition: background var(--transition), transform var(--transition); }
.quantity-controls .minus:hover, .quantity-controls .plus:hover { background: rgba(182,110,65,0.06); transform: translateY(-2px); }
.quantity-badge { font-weight:700; color:#fff; min-width:28px; text-align:center; }

/* Customize badge (top-right) */
.customize-badge { position:absolute; top:12px; right:12px; background: transparent; color:var(--gold); font-size:12px; padding:6px 10px; border-radius:10px; font-weight:700; cursor:pointer; z-index:2; display:flex; align-items:center; gap:8px; border:1px solid rgba(182,110,65,0.18); backdrop-filter: blur(2px); transition: background var(--transition), color var(--transition), transform var(--transition); box-shadow: 0 6px 18px rgba(0,0,0,0.6); }
.customize-badge:hover { background: rgba(182,110,65,0.08); color:#fff; transform: translateY(-4px); }

/* Footer */
footer { text-align:center; padding:22px; background:transparent; color:#bdbdbd; margin-top:60px; border-top:1px solid rgba(255,255,255,0.02); }

/* MEDIA */
@media(max-width:900px){ .product-grid { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); } }
@media(max-width:600px){
  .product-grid { grid-template-columns: repeat(2, 1fr); gap:12px; }
  .product-card img { height:140px; }
  .header-right { display:none; flex-direction:column; background:rgba(20,21,23,0.98); position:absolute; top:70px; right:0; width:220px; padding:18px; border-radius:8px; z-index:1100; }
  .header-right.open { display:flex; }
  .hamburger { display:block; }
  .mobile-cart { display:flex; align-items:center; margin-right:10px; }
  .mobile-cart a { color:var(--gold); font-size:20px; position:relative; }
  .mobile-cart .cart-count { position:absolute; top:-8px; right:-8px; }
  .customize-badge { font-size:13px; padding:7px 10px; }
  .hero { height:42vh; margin-top:20px; padding-top:80px; } 
  .hero-text h1 { font-size:clamp(24px,5vw,32px); line-height:1.2; margin:0; }
  .hero-text p { font-size:clamp(14px,2.5vw,18px); margin:0 auto; color:#d2c9c0; }
}

/* Small accessibility & focus states */
button:focus, a:focus, input:focus, select:focus { outline: 3px solid rgba(182,110,65,0.12); outline-offset:2px; }
</style>
</head>
<body>

<!-- HEADER -->
<header class="site-header">
  <div class="header-left">
    <img src="logo.png" alt="Sérac Logo" class="brand-logo">
    <div class="brand-title">Sérac</div>
  </div>
  <div class="mobile-cart" style="display:none;">
    <a href="cart.html"><i class="fa-solid fa-cart-shopping"></i><span class="cart-count" id="cartCountMobile">0</span></a>
  </div>
  <nav class="header-right">
    <a href="index.html">Home</a>
    <a href="about.html">About</a>
    <a href="cart.html">Cart <span class="cart-count" id="cartCount">0</span></a>
    <a href="customization.html">Customize</a>
    <a href="contact.html">Contact</a>
  </nav>
  <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
</header>

<!-- HERO -->
<section class="hero">
  <div class="hero-text">
    <h1>Shop</h1>
    <p>Explore our collection of products</p>
  </div>
</section>

<!-- SHOP -->
<section class="shop">
  <div class="container">
    <h2>Our Products</h2>
    <div class="shop-controls">
      <input type="text" id="searchInput" placeholder="Search products...">
      <div class="currency-filter-group">
        <select id="currencySelect">
          <option value="NGN">NGN</option>
          <option value="USD">USD</option>
          <option value="EUR">EUR</option>
          <option value="GBP">GBP</option>
        </select>
        <select id="sortSelect">
          <option value="">Filter / Sort</option>
          <option value="alphabet">Alphabet</option>
          <option value="price-asc">Price: Low → High</option>
          <option value="price-desc">Price: High → Low</option>
        </select>
      </div>
    </div>
    <div class="product-grid" id="productGrid"></div>
  </div>
</section>

<!-- FOOTER -->
<footer>
  <p>© 2025 Sérac</p>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCuiZXHFYl1fVKnGwojavRvbekSBpkipJg",
  authDomain: "brandisby.firebaseapp.com",
  projectId: "brandisby",
  storageBucket: "brandisby.firebasestorage.app",
  messagingSenderId: "87213267039",
  appId: "1:87213267039:web:339e9fd49e3ad31f7423ea"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const productGrid = document.getElementById('productGrid');
const cartCountElem = document.getElementById('cartCount');
const cartCountMobileElem = document.getElementById('cartCountMobile');
const searchInput = document.getElementById('searchInput');
const sortSelect = document.getElementById('sortSelect');
const currencySelect = document.getElementById('currencySelect');

let cart = JSON.parse(localStorage.getItem('cart')) || [];
let productsData = {};

if(localStorage.getItem('currency')) currencySelect.value = localStorage.getItem('currency');
currencySelect.addEventListener('change', ()=>{ localStorage.setItem('currency', currencySelect.value); loadProducts(); });

function getCart(){ return JSON.parse(localStorage.getItem('cart')) || []; }
function setCart(cartArray){ 
  cart = mergeCartItems(cartArray); 
  localStorage.setItem('cart', JSON.stringify(cart)); 
  updateCartCount(); 
}

function updateCartCount(){ 
  const total = cart.reduce((sum,i)=>sum+(i.quantity||0),0); 
  cartCountElem.textContent=total; 
  cartCountMobileElem.textContent=total;
}

// Merge cart items by id + variant
function mergeCartItems(cartArray){
  const merged = [];
  cartArray.forEach(item=>{
    const idx = merged.findIndex(i=>i.id===item.id && (i.color||'')=== (item.color||'') && (i.size||'')=== (item.size||''));
    if(idx===-1) merged.push({...item});
    else merged[idx].quantity = (merged[idx].quantity||0) + (item.quantity||0);
  });
  return merged;
}

// Calculate total quantity for product across all variants
function getTotalQuantity(productId){
  return cart.filter(i=>i.id===productId).reduce((sum,i)=>sum+(i.quantity||0),0);
}

function addToCart(product){
  let currentCart = getCart();
  const idx = currentCart.findIndex(i=>i.id===product.id && (i.color||'')===(product.color||'') && (i.size||'')===(product.size||''));
  if(idx>-1) currentCart[idx].quantity +=1;
  else currentCart.push({...product,quantity:1});
  setCart(currentCart);
  updateProductUI(product.id);
}

function removeFromCart(productId){
  let currentCart = getCart();
  const idx = currentCart.findIndex(i=>i.id===productId);
  if(idx>-1){ currentCart[idx].quantity-=1; if(currentCart[idx].quantity<=0) currentCart.splice(idx,1); }
  setCart(currentCart);
  updateProductUI(productId);
}

// Update product card UI based on total quantity across all variants
function updateProductUI(productId){
  const card = document.getElementById(`product-${productId}`);
  if(!card) return;
  const addBtn = card.querySelector('.add-cart');
  const badge = card.querySelector('.quantity-badge');
  const totalQty = getTotalQuantity(productId);
  if(totalQty>0){ addBtn.style.display='none'; badge.textContent=totalQty; } 
  else { addBtn.style.display='block'; badge.textContent=''; }
}

function formatPrice(product, currency){
  if(!product) return '';
  const price = currency==='NGN'?product.priceNGN:currency==='USD'?product.priceUSD:currency==='EUR'?product.priceEUR:currency==='GBP'?product.priceGBP:product.priceNGN;
  const localeMap={ NGN:'en-NG', USD:'en-US', EUR:'de-DE', GBP:'en-GB' };
  return new Intl.NumberFormat(localeMap[currency],{style:'currency',currency,minimumFractionDigits:currency==='NGN'?0:2}).format(price);
}

async function loadProducts(){
  try{
    // UPDATED: load from Sérac brand path
    const q = query(collection(db,"brands","serac","products"), where("published","==",true));
    const snapshot = await getDocs(q);
    const products=[];
    snapshot.forEach(doc=>{
      const data=doc.data();
      if(!data.name || !data.imageUrl) return;
      products.push({id:doc.id,...data});
      productsData[doc.id]=data;
    });
    displayProducts(products);
  }catch(e){ console.error(e); productGrid.innerHTML='<p style="text-align:center;color:tomato;">Failed to load products.</p>'; }
}

function displayProducts(products){
  const term = searchInput.value.toLowerCase();
  let filtered = products.filter(p=>p.name.toLowerCase().includes(term));
  const sortVal = sortSelect.value;
  const currency = currencySelect.value;
  function getPriceForCurrency(product){ return currency==='NGN'?product.priceNGN:currency==='USD'?product.priceUSD:currency==='EUR'?product.priceEUR:currency==='GBP'?product.priceGBP:product.priceNGN; }
  if(sortVal==='alphabet') filtered.sort((a,b)=>a.name.localeCompare(b.name));
  if(sortVal==='price-asc') filtered.sort((a,b)=>getPriceForCurrency(a)-getPriceForCurrency(b));
  if(sortVal==='price-desc') filtered.sort((a,b)=>getPriceForCurrency(b)-getPriceForCurrency(a));

  productGrid.innerHTML='';
  for(const p of filtered){
    const quantity = getTotalQuantity(p.id);
    const priceForCurrency = getPriceForCurrency(p);

    const div = document.createElement('div');
    div.className='product-card';
    div.id=`product-${p.id}`;

    div.innerHTML=`
      ${p.customizationAvailable?`<a href="customization.html?productId=${p.id}" class="customize-badge" onclick="event.stopPropagation()"><i class="fa-solid fa-wand-magic-sparkles"></i> Customize</a>`:''}
      <a href="product.html?productId=${p.id}&price=${priceForCurrency}&currency=${currency}">
        <img src="${p.imageUrl}" alt="${p.name}">
      </a>
      <h3>${p.name}</h3>
      <div class="description">${truncateText(p.description||'',15)}</div>
      <div class="price">${formatPrice(p,currency)}</div>
      <div class="quantity-controls">
        <button class="minus">-</button>
        <span class="quantity-badge">${quantity>0?quantity:''}</span>
        <button class="plus">+</button>
      </div>
      <button class="add-cart" style="display:${quantity>0?'none':'block'};">Add to Cart</button>
    `;

    div.querySelector('.plus').addEventListener('click', e=>{ e.stopPropagation(); addToCart(p); });
    div.querySelector('.minus').addEventListener('click', e=>{ e.stopPropagation(); removeFromCart(p.id); });
    div.querySelector('.add-cart').addEventListener('click', e=>{ e.stopPropagation(); addToCart(p); });

    productGrid.appendChild(div);
  }
}

function truncateText(text, wordLimit){ return text.split(' ').slice(0,wordLimit).join(' '); }

searchInput.addEventListener('input', loadProducts);
sortSelect.addEventListener('change', loadProducts);

document.getElementById('hamburger').addEventListener('click', ()=>{
  document.querySelector('.header-right').classList.toggle('open');
  document.getElementById('hamburger').classList.toggle('open');
});

function handleMobileCart(){ document.querySelector('.mobile-cart').style.display=window.innerWidth<=600?'flex':'none'; }
window.addEventListener('resize', handleMobileCart);
handleMobileCart();

updateCartCount();
loadProducts();
window.addEventListener('storage', ()=>{ 
  cart = JSON.parse(localStorage.getItem('cart')) || [];
  cart = mergeCartItems(cart);
  updateCartCount();
  loadProducts();
});
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fleur De Vie - Admin Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#fafafa; }
    header { background:#333; color:#fff; padding:15px; text-align:center; }
    .container { max-width:1200px; margin:20px auto; padding:20px; background:#fff; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
    nav { display:flex; justify-content:center; margin-bottom:20px; }
    nav button { margin:0 10px; padding:10px 20px; border:none; background:#333; color:#fff; cursor:pointer; border-radius:5px; }
    nav button.active { background:#555; }
    .tab { display:none; }
    .tab.active { display:block; }
    form { margin-bottom:20px; }
    form input, form textarea, form select { display:block; width:100%; padding:8px; margin:8px 0; border:1px solid #ccc; border-radius:5px; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    table, th, td { border:1px solid #ccc; }
    th, td { padding:10px; text-align:left; }
    .export-controls { margin: 15px 0; display:flex; gap:10px; align-items:center; }
  </style>
</head>
<body>
  <header>
    <h1>Admin Dashboard</h1>
  </header>

  <div class="container">
    <nav>
      <button onclick="openTab('products')" class="active">Products</button>
      <button onclick="openTab('quotes')">Quotes</button>
      <button onclick="openTab('orders')">Orders</button>
    </nav>

    <!-- PRODUCTS TAB -->
    <div id="products" class="tab active">
      <h2>Manage Products</h2>
      <form id="productForm">
        <input type="text" id="productName" placeholder="Product Name" required>
        <textarea id="productDescription" placeholder="Product Description"></textarea>
        <input type="text" id="productImage" placeholder="Image URL" required>
        <input type="number" id="priceNGN" placeholder="Price (NGN)">
        <input type="number" id="priceUSD" placeholder="Price (USD)">
        <input type="number" id="priceEUR" placeholder="Price (EUR)">
        <input type="number" id="priceGBP" placeholder="Price (GBP)">
        <label><input type="checkbox" id="productPublished"> Published</label>
        <button type="submit">Save Product</button>
      </form>
      <table id="productsTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Image</th>
            <th>Prices</th>
            <th>Published</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- QUOTES TAB -->
    <div id="quotes" class="tab">
      <h2>Generate Quotes</h2>
      <form id="quoteForm">
        <input type="text" id="quoteCustomerName" placeholder="Customer Name" required>
        <input type="text" id="quoteCustomerPhone" placeholder="Customer Phone" required>
        <textarea id="quoteDescription" placeholder="Quote Description"></textarea>
        <input type="number" id="quoteNGN" placeholder="Total Price (NGN)">
        <input type="number" id="quoteUSD" placeholder="Total Price (USD)">
        <input type="number" id="quoteEUR" placeholder="Total Price (EUR)">
        <input type="number" id="quoteGBP" placeholder="Total Price (GBP)">
        <button type="submit">Save Quote</button>
      </form>
      <table id="quotesTable">
        <thead>
          <tr>
            <th>Customer</th>
            <th>Description</th>
            <th>Prices</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- ORDERS TAB -->
    <div id="orders" class="tab">
      <h2>Manage Orders</h2>
      <div class="export-controls">
        <label>From: <input type="date" id="exportFrom"></label>
        <label>To: <input type="date" id="exportTo"></label>
        <select id="exportCurrency">
          <option value="NGN">NGN</option>
          <option value="USD">USD</option>
          <option value="EUR">EUR</option>
          <option value="GBP">GBP</option>
        </select>
        <button onclick="exportOrders()">Export Orders</button>
      </div>
      <table id="ordersTable">
        <thead>
          <tr>
            <th>Customer</th>
            <th>Items</th>
            <th>Total</th>
            <th>Status</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // Firebase config (same as before)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Tab switcher
    function openTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      event.target.classList.add('active');
    }

    // ============ PRODUCTS ============
    const productForm = document.getElementById("productForm");
    const productsTable = document.getElementById("productsTable").querySelector("tbody");

    productForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const newProduct = {
        name: document.getElementById("productName").value,
        description: document.getElementById("productDescription").value,
        image: document.getElementById("productImage").value,
        prices: {
          NGN: document.getElementById("priceNGN").value || null,
          USD: document.getElementById("priceUSD").value || null,
          EUR: document.getElementById("priceEUR").value || null,
          GBP: document.getElementById("priceGBP").value || null,
        },
        published: document.getElementById("productPublished").checked
      };
      await db.collection("products").add(newProduct);
      productForm.reset();
      loadProducts();
    });

    async function loadProducts() {
      const snapshot = await db.collection("products").get();
      productsTable.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const row = `<tr>
          <td>${data.name}</td>
          <td><img src="${data.image}" width="50"></td>
          <td>NGN: ${data.prices.NGN || "-"}, USD: ${data.prices.USD || "-"}, EUR: ${data.prices.EUR || "-"}, GBP: ${data.prices.GBP || "-"}</td>
          <td>${data.published ? "Yes" : "No"}</td>
          <td><button onclick="deleteProduct('${doc.id}')">Delete</button></td>
        </tr>`;
        productsTable.innerHTML += row;
      });
    }
    async function deleteProduct(id) {
      await db.collection("products").doc(id).delete();
      loadProducts();
    }
    loadProducts();

    // ============ QUOTES ============
    const quoteForm = document.getElementById("quoteForm");
    const quotesTable = document.getElementById("quotesTable").querySelector("tbody");

    quoteForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const newQuote = {
        customerName: document.getElementById("quoteCustomerName").value,
        customerPhone: document.getElementById("quoteCustomerPhone").value,
        description: document.getElementById("quoteDescription").value,
        prices: {
          NGN: document.getElementById("quoteNGN").value || null,
          USD: document.getElementById("quoteUSD").value || null,
          EUR: document.getElementById("quoteEUR").value || null,
          GBP: document.getElementById("quoteGBP").value || null,
        },
        createdAt: new Date()
      };
      await db.collection("quotes").add(newQuote);
      quoteForm.reset();
      loadQuotes();
    });

    async function loadQuotes() {
      const snapshot = await db.collection("quotes").get();
      quotesTable.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const row = `<tr>
          <td>${data.customerName} (${data.customerPhone})</td>
          <td>${data.description}</td>
          <td>NGN: ${data.prices.NGN || "-"}, USD: ${data.prices.USD || "-"}, EUR: ${data.prices.EUR || "-"}, GBP: ${data.prices.GBP || "-"}</td>
          <td><button onclick="deleteQuote('${doc.id}')">Delete</button></td>
        </tr>`;
        quotesTable.innerHTML += row;
      });
    }
    async function deleteQuote(id) {
      await db.collection("quotes").doc(id).delete();
      loadQuotes();
    }
    loadQuotes();

    // ============ ORDERS ============
    const ordersTable = document.getElementById("ordersTable").querySelector("tbody");

    async function loadOrders() {
      const snapshot = await db.collection("orders").get();
      ordersTable.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const row = `<tr>
          <td>${data.customerName}</td>
          <td>${(data.items || []).map(i => `${i.name} (x${i.qty})`).join(", ")}</td>
          <td>${JSON.stringify(data.total || {})}</td>
          <td>${data.status}</td>
          <td>${data.createdAt?.toDate().toLocaleDateString() || "-"}</td>
        </tr>`;
        ordersTable.innerHTML += row;
      });
    }
    loadOrders();

    function exportOrders() {
      const from = new Date(document.getElementById("exportFrom").value);
      const to = new Date(document.getElementById("exportTo").value);
      const currency = document.getElementById("exportCurrency").value;

      db.collection("orders").get().then(snapshot => {
        let csv = "Customer,Items,Total (" + currency + "),Status,Date\n";
        snapshot.forEach(doc => {
          const data = doc.data();
          const orderDate = data.createdAt?.toDate();
          if (from && orderDate < from) return;
          if (to && orderDate > to) return;

          const items = (data.items || []).map(i => `${i.name} (x${i.qty})`).join(" | ");
          const total = data.total?.[currency] || "-";
          csv += `${data.customerName},${items},${total},${data.status},${orderDate?.toLocaleDateString()}\n`;
        });

        const blob = new Blob([csv], { type: "text/csv" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "orders_export.csv";
        link.click();
      });
    }
  </script>
</body>
</html>

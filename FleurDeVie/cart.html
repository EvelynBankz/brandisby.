<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fleur De Vie - Cart</title>

  <!-- Fonts & icons -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* ======= SAME STYLES AS BEFORE ======= */
    /* RESET, HEADER, HERO, CART, FOOTER, RESPONSIVE (copy all CSS from previous version) */
    /* For brevity, assume all CSS from previous cart.html is here */
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="site-header">
    <div class="header-left">
      <img src="logo.png" alt="Fleur De Vie Logo" class="brand-logo">
      <div class="brand-title">Fleur De Vie</div>
    </div>
    <nav class="header-right">
      <a href="index.html">Home</a>
      <a href="shop.html">Shop</a>
      <a href="checkout.html">Checkout</a>
    </nav>
    <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
    <div class="dropdown-menu" id="dropdown-menu">
      <button class="dropdown-close" id="dropdown-close">&times;</button>
      <a href="index.html">Home</a>
      <a href="shop.html">Shop</a>
      <a href="checkout.html">Checkout</a>
    </div>
  </header>

  <!-- HERO / TITLE -->
  <section class="hero-cart">
    <div class="hero-text">
      <h1>Your Shopping Cart</h1>
    </div>
  </section>

  <!-- CART -->
  <main class="cart">
    <div class="cart-table-wrap">
      <table id="cart-table">
        <thead>
          <tr>
            <th>Image</th><th>Name</th><th>Price</th><th>Qty</th><th>Total</th><th>Action</th>
          </tr>
        </thead>
        <tbody id="cart-body"></tbody>
      </table>
    </div>
    <div id="empty-message" class="empty-message">Your cart is empty</div>
    <div id="cart-total">Total: $0.00</div>
    <div class="bottom-controls">
      <a class="btn" href="shop.html"><i class="fa fa-arrow-left"></i> Continue Shopping</a>
      <a class="btn" id="checkout-link" href="checkout.html"><i class="fa fa-credit-card"></i> Checkout</a>
      <select id="currency-selector" class="currency-select">
        <option value="USD" selected>USD $</option>
        <option value="EUR">EUR €</option>
        <option value="GBP">GBP £</option>
        <option value="NGN">NGN ₦</option>
      </select>
    </div>

    <!-- FEATURED PRODUCTS -->
    <section id="featured">
      <h2>You May Also Like</h2>
      <div class="products-grid" id="featured-products"></div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <p>© 2025 Fleur De Vie</p>
  </footer>

  <!-- FIREBASE -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const cartBody = document.getElementById('cart-body');
    const totalEl = document.getElementById('cart-total');
    const emptyEl = document.getElementById('empty-message');
    const currencySel = document.getElementById('currency-selector');
    const featuredGrid = document.getElementById('featured-products');

    const RATES = {USD:1,EUR:0.93,GBP:0.8,NGN:1600};

    function getCart() { return JSON.parse(localStorage.getItem('fleurdevie-cart') || '[]'); }
    function saveCart(c) { localStorage.setItem('fleurdevie-cart', JSON.stringify(c)); }
    function fmt(val, cur) {
      if(cur==="USD") return "$"+val.toFixed(2);
      if(cur==="EUR") return "€"+val.toFixed(2);
      if(cur==="GBP") return "£"+val.toFixed(2);
      if(cur==="NGN") return "₦"+Math.round(val);
      return val;
    }

    async function fetchProducts() {
      const productsCol = collection(db, 'products');
      const productSnapshot = await getDocs(productsCol);
      return productSnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
    }

    async function renderCart() {
      const cur = localStorage.getItem('fleurdevie-currency') || currencySel.value;
      currencySel.value = cur;
      const cart = getCart();
      cartBody.innerHTML = ""; let total = 0;

      if(cart.length === 0) {
        emptyEl.style.display = "block";
        totalEl.textContent = "Total: "+fmt(0,cur);
        return;
      }
      emptyEl.style.display = "none";

      // Fetch all products from Firebase to get latest price & image
      const products = await fetchProducts();

      cart.forEach((item,i)=>{
        const prod = products.find(p=>p.id===item.id);
        const price = (prod?.price || item.price) * RATES[cur];
        const subtotal = price * item.quantity;
        total += subtotal;

        const tr = document.createElement('tr');
        tr.innerHTML = `<td><img src="${prod?.imageUrl || item.imageUrl || 'placeholder.jpg'}"></td>
          <td>${prod?.name || item.name}</td>
          <td>${fmt(price,cur)}</td>
          <td><input type="number" min="1" value="${item.quantity}" data-i="${i}" style="width:60px"></td>
          <td>${fmt(subtotal,cur)}</td>
          <td><button data-i="${i}" class="btn">Remove</button></td>`;
        cartBody.appendChild(tr);
      });

      totalEl.textContent = "Total: " + fmt(total,cur);

      cartBody.querySelectorAll('input[type=number]').forEach(inp=>{
        inp.onchange=e=>{ const i=inp.dataset.i; cart[i].quantity = Math.max(1,parseInt(inp.value)); saveCart(cart); renderCart(); }
      });
      cartBody.querySelectorAll('button').forEach(btn=>{
        btn.onclick=e=>{ const i=btn.dataset.i; cart.splice(i,1); saveCart(cart); renderCart(); }
      });
    }

    currencySel.onchange = e => { localStorage.setItem('fleurdevie-currency',currencySel.value); renderCart(); }

    async function renderFeatured() {
      const products = await fetchProducts();
      products.slice(0,4).forEach(p=>{
        const card = document.createElement('div');
        card.className='product-card';
        card.innerHTML = `<img src="${p.imageUrl}" alt="${p.name}"><h3>${p.name}</h3>
          <p>${fmt(p.price,'USD')}</p>
          <a class="btn add-btn" href="shop.html"><i class="fa fa-shopping-cart"></i> Add</a>`;
        featuredGrid.appendChild(card);
      });
    }

    // Mobile menu
    const hamburger=document.getElementById('hamburger');
    const dropdown=document.getElementById('dropdown-menu');
    const closeBtn=document.getElementById('dropdown-close');
    hamburger.onclick=()=>dropdown.classList.add('open');
    closeBtn.onclick=()=>dropdown.classList.remove('open');
    document.addEventListener('click',e=>{
      if(!dropdown.contains(e.target)&&!hamburger.contains(e.target)) dropdown.classList.remove('open');
    });

    renderCart();
    renderFeatured();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fleur De Vie - Checkout</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family:"Montserrat", sans-serif; background:#F5E6CC; color:#112e1f; margin:0; }
    header { background:#112e1f; color:#F5E6CC; padding:20px; text-align:center; font-family:"Playfair Display", serif; font-size:24px; font-weight:700; }
    .checkout-container { max-width:800px; margin:40px auto; padding:20px; background:#fff; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
    h2 { font-family:"Playfair Display", serif; margin-bottom:20px; }
    form { display:grid; gap:16px; }
    input, select, textarea { width:100%; padding:12px; border:1px solid #ccc; border-radius:8px; }
    button { background:#112e1f; color:#F5E6CC; padding:14px; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition:0.3s; }
    button:hover { background:#0a1d14; }
    .order-summary { margin-top:20px; padding:16px; background:#FFD6BA; border-radius:8px; }
    .currency-selector { margin-bottom:10px; }
    footer { text-align:center; padding:20px; background:#112e1f; color:#F5E6CC; margin-top:40px; }
  </style>
</head>
<body>

<header>Fleur De Vie - Checkout</header>

<div class="checkout-container">
  <h2>Billing Information</h2>
  <form id="checkoutForm">
    <input type="text" id="name" placeholder="Full Name" required>
    <input type="email" id="email" placeholder="Email Address" required>
    <input type="tel" id="phone" placeholder="Phone Number" required>
    <textarea id="address" placeholder="Shipping Address" required></textarea>

    <div class="currency-selector">
      <label for="currency">Currency:</label>
      <select id="currency">
        <option value="NGN">NGN (₦)</option>
        <option value="USD">USD ($)</option>
        <option value="EUR">EUR (€)</option>
      </select>
    </div>

    <div class="order-summary" id="orderSummary">
      <h3>Order Summary</h3>
      <p id="orderItems"></p>
      <p><strong>Total:</strong> <span id="orderTotal">0</span></p>
    </div>

    <button type="submit">Place Order</button>
  </form>
</div>

<footer>© 2025 Fleur De Vie</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCuiZXHFYl1fVKnGwojavRvbekSBpkipJg",
    authDomain: "brandisby.firebaseapp.com",
    projectId: "brandisby",
    storageBucket: "brandisby.firebasestorage.app",
    messagingSenderId: "87213267039",
    appId: "1:87213267039:web:339e9fd49e3ad31f7423ea"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  function getCart() {
    return JSON.parse(localStorage.getItem("cart")) || [];
  }

  function displayOrderSummary() {
    const cart = getCart();
    const orderItemsElem = document.getElementById("orderItems");
    const orderTotalElem = document.getElementById("orderTotal");
    const currency = document.getElementById("currency").value;
    
    let total = 0;
    orderItemsElem.innerHTML = "";
    cart.forEach(item => {
      const line = document.createElement("p");
      line.textContent = `${item.name} x ${item.quantity} - ${currency} ${item.price * item.quantity}`;
      orderItemsElem.appendChild(line);
      total += item.price * item.quantity;
    });
    orderTotalElem.textContent = `${currency} ${total}`;
  }

  document.getElementById("currency").addEventListener("change", displayOrderSummary);

  document.getElementById("checkoutForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const cart = getCart();
    if (cart.length === 0) {
      alert("Your cart is empty!");
      return;
    }

    const orderData = {
      name: document.getElementById("name").value,
      email: document.getElementById("email").value,
      phone: document.getElementById("phone").value,
      address: document.getElementById("address").value,
      currency: document.getElementById("currency").value,
      items: cart,
      total: document.getElementById("orderTotal").textContent,
      createdAt: serverTimestamp()
    };

    try {
      await addDoc(collection(db, "orders"), orderData);
      alert("Order placed successfully!");
      localStorage.removeItem("cart");
      window.location.href = "thankyou.html";
    } catch (err) {
      console.error("Error saving order:", err);
      alert("Failed to place order, please try again.");
    }
  });

  displayOrderSummary();
</script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Checkout</title>

  <!-- Flutterwave Inline SDK -->
  <script src="https://checkout.flutterwave.com/v3.js"></script>

  <!-- Page styles (combined CSS) -->
  <style>
    /* --- Basic reset & type --- */
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#0ea5a3;
      --danger:#ef4444;
      --shadow: 0 6px 20px rgba(15,23,42,0.08);
      --radius:12px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:#0f172a}
    a{color:inherit}
    /* page container */
    .container{
      max-width:1150px;
      margin:36px auto;
      padding:28px;
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:24px;
      align-items:start;
    }

    /* left column — checkout form */
    .checkout-card{
      background:var(--card);
      border-radius:var(--radius);
      padding:22px;
      box-shadow:var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      gap:18px;
    }
    .section-title{
      font-weight:600;
      font-size:16px;
      margin-bottom:6px;
    }

    /* cart list */
    .cart-list{display:flex;flex-direction:column;gap:12px}
    .cart-item{
      display:flex;gap:12px;align-items:center;padding:12px;border-radius:10px;border:1px solid rgba(15,23,42,0.04);
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .cart-item:hover{transform:translateY(-3px);box-shadow:0 8px 30px rgba(15,23,42,0.06)}
    .cart-item img{width:72px;height:72px;object-fit:cover;border-radius:8px}
    .cart-item .meta{flex:1}
    .cart-item .meta .name{font-weight:600}
    .cart-item .meta .sku{font-size:12px;color:var(--muted);margin-top:6px}
    .qty-controls{display:flex;align-items:center;gap:8px}
    .qty-controls button{width:30px;height:30px;border-radius:8px;border:1px solid rgba(15,23,42,0.06);background:#fff;cursor:pointer}
    .remove-item{background:transparent;border:none;color:var(--danger);cursor:pointer;font-size:13px;padding:4px 6px}

    /* forms */
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .field{display:flex;flex-direction:column;gap:6px}
    label{font-size:13px;color:var(--muted)}
    input[type="text"], input[type="email"], input[type="tel"], select, textarea{
      padding:10px 12px;border-radius:10px;border:1px solid rgba(15,23,42,0.06);outline:none;font-size:14px;
      transition:box-shadow .12s ease, border-color .12s ease;
    }
    input:focus, select:focus, textarea:focus{box-shadow:0 6px 20px rgba(14,165,164,0.06);border-color:rgba(14,165,164,0.3)}
    .muted{color:var(--muted);font-size:13px}

    /* promo */
    .promo-row{display:flex;gap:8px;align-items:center}
    .promo-row input{flex:1}
    .apply-btn{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer}

    /* delivery options */
    .delivery-options{display:flex;gap:8px;flex-wrap:wrap}
    .delivery-option{border:1px solid rgba(15,23,42,0.06);padding:10px 12px;border-radius:10px;cursor:pointer;min-width:140px}
    .delivery-option.active{border-color:var(--accent);box-shadow:0 6px 18px rgba(14,165,164,0.06)}

    /* right column — summary */
    .summary-card{
      background:var(--card);
      border-radius:var(--radius);
      padding:22px;
      box-shadow:var(--shadow);
      position:sticky;top:28px;
    }
    .summary-line{display:flex;justify-content:space-between;align-items:center;padding:8px 0}
    .summary-line.total{font-weight:700;font-size:18px;border-top:1px dashed rgba(15,23,42,0.04);padding-top:14px;margin-top:8px}

    .pay-btn{
      display:block;width:100%;margin-top:14px;padding:12px;border-radius:10px;border:none;background:linear-gradient(90deg,#0ea5a3,#06b6d4);color:white;font-weight:700;font-size:16px;cursor:pointer;
    }
    .pay-btn[disabled]{opacity:.6;cursor:not-allowed}

    /* small helpers */
    .note{font-size:13px;color:var(--muted)}
    .success{color:green}
    .error{color:var(--danger)}

    /* modals (simple) */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:flex;align-items:center;justify-content:center;z-index:60}
    .modal{
      background:#fff;border-radius:12px;padding:20px;min-width:320px;max-width:720px;box-shadow:0 36px 60px rgba(2,6,23,0.5)
    }
    .modal h3{margin:0 0 10px 0}
    .modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:16px}

    /* responsive */
    @media (max-width:1000px){
      .container{grid-template-columns:1fr; padding:18px}
      .summary-card{position:relative;top:0}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- LEFT: Checkout content -->
    <div class="checkout-card" id="checkout-card">
      <div>
        <div class="section-title">Your cart</div>
        <div class="muted">Review items and edit quantities before checkout</div>
      </div>

      <div class="cart-list" id="cart-list">
        <!-- Cart items inserted via JS. Uses asset paths like /assets/... -->
      </div>

      <div>
        <div class="section-title">Shipping information</div>
        <div class="muted">Where should we deliver your order?</div>

        <div class="grid-2" style="margin-top:10px">
          <div class="field">
            <label for="firstName">First name</label>
            <input id="firstName" name="firstName" type="text" placeholder="Jane" />
            <div class="field-error muted" id="err-firstName"></div>
          </div>
          <div class="field">
            <label for="lastName">Last name</label>
            <input id="lastName" name="lastName" type="text" placeholder="Doe" />
            <div class="field-error muted" id="err-lastName"></div>
          </div>
        </div>

        <div class="field" style="margin-top:10px">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" placeholder="you@example.com" />
          <div class="field-error muted" id="err-email"></div>
        </div>

        <div class="field" style="margin-top:10px">
          <label for="address">Address</label>
          <input id="address" name="address" type="text" placeholder="123 Example St" />
          <div class="field-error muted" id="err-address"></div>
        </div>

        <div class="grid-2" style="margin-top:10px">
          <div class="field">
            <label for="city">City</label>
            <input id="city" type="text" />
            <div class="field-error muted" id="err-city"></div>
          </div>
          <div class="field">
            <label for="postcode">Postal code</label>
            <input id="postcode" type="text" />
            <div class="field-error muted" id="err-postcode"></div>
          </div>
        </div>

        <div class="grid-2" style="margin-top:10px">
          <div class="field">
            <label for="country">Country</label>
            <select id="country">
              <option value="NG">Nigeria</option>
              <option value="GH">Ghana</option>
              <option value="US">United States</option>
              <option value="GB">United Kingdom</option>
            </select>
          </div>
          <div class="field">
            <label for="phone">Phone</label>
            <input id="phone" type="tel" placeholder="+2348012345678" />
            <div class="field-error muted" id="err-phone"></div>
          </div>
        </div>
      </div>

      <div>
        <div class="section-title">Delivery method</div>
        <div class="muted">Choose a delivery speed</div>
        <div class="delivery-options" style="margin-top:10px" id="delivery-options">
          <div class="delivery-option active" data-id="standard" data-cost="500">
            <div style="font-weight:600">Standard — 3–5 days</div>
            <div class="muted">₦500</div>
          </div>
          <div class="delivery-option" data-id="express" data-cost="1500">
            <div style="font-weight:600">Express — 1–2 days</div>
            <div class="muted">₦1,500</div>
          </div>
          <div class="delivery-option" data-id="pickup" data-cost="0">
            <div style="font-weight:600">Pickup</div>
            <div class="muted">Free</div>
          </div>
        </div>
      </div>

      <div>
        <div class="section-title">Promo code</div>
        <div class="muted">Add a coupon to receive a discount</div>
        <div style="margin-top:10px" class="promo-row">
          <input id="promo-code" placeholder="SUMMER20" />
          <button class="apply-btn" id="apply-promo">Apply</button>
        </div>
        <div class="muted" id="promo-feedback" style="margin-top:8px"></div>
      </div>

      <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:10px">
        <div class="note">Order notes (optional)</div>
        <textarea id="order-notes" placeholder="Leave a note for the seller..." style="width:60%;border-radius:8px;padding:10px;border:1px solid rgba(15,23,42,0.06)"></textarea>
      </div>

    </div>

    <!-- RIGHT: Order Summary -->
    <aside class="summary-card" aria-labelledby="summary-title">
      <div>
        <div id="summary-title" class="section-title">Order summary</div>
        <div class="muted">Review before paying</div>
      </div>

      <div style="margin-top:12px">
        <div class="summary-line"><div>Subtotal</div><div id="summary-subtotal">₦0</div></div>
        <div class="summary-line"><div>Delivery</div><div id="summary-delivery">₦500</div></div>
        <div class="summary-line"><div>Tax (VAT)</div><div id="summary-tax">₦0</div></div>
        <div class="summary-line"><div>Discount</div><div id="summary-discount">₦0</div></div>
        <div class="summary-line total"><div>Total</div><div id="summary-total">₦0</div></div>

        <button class="pay-btn" id="pay-button">Pay with Flutterwave</button>

        <div style="margin-top:10px">
          <div class="muted">Payment powered by Flutterwave. All payments are verified before storing your order in Firestore.</div>
        </div>
      </div>
    </aside>
  </div>

  <!-- Simple modal placeholders -->
  <div id="modal-root" style="display:none"></div>

  <!-- External JS -->
  <script type="module">>
    /* checkout.js
   Pure JS checkout logic:
   - Cart management (localStorage)
   - DOM updates
   - Form validation
   - Firebase v9 modular SDK usage
   - Flutterwave inline integration
   - POST to /api/verify-payment for verification
   - Firestore order write (collection: orders)
*/

/* ====================
   CONFIGURATION
   ==================== */

/* Replace this firebaseConfig object with the one from your Firebase project.
   The sample original used this variable name, so we keep it identical.
*/
const firebaseConfig = {
 apiKey: "AIzaSyCuiZXHFYl1fVKnGwojavRvbekSBpkipJg",
  authDomain: "brandisby.firebaseapp.com",
  projectId: "brandisby",
  storageBucket: "brandisby.firebasestorage.app",
  messagingSenderId: "87213267039",
  appId: "1:87213267039:web:339e9fd49e3ad31f7423ea"
};

/* Flutterwave public key placeholder - replace with your live/test key */
const FLW_PUBLIC_KEY = "FLWPUBK_TEST-07eb9d2da345c08dc4d54278c3bc86f7-X";

/* Firestore collection names and field keys must match the original:
   - orders collection (document contains: user, items, totals, payment, createdAt)
*/
const ORDERS_COLLECTION = "orders";

/* ====================
   IMPORTS & INIT FIREBASE (v9 modular)
   ==================== */

/* Note: on static sites you must load firebase via CDN or bundler; below uses dynamic import of modular SDK
   For production, include <script type="module"> to import from https://www.gstatic.com/firebasejs/9.x.x/firebase-app.js etc.
   For simplicity and to match "single file + separate JS file", we use dynamic imports here.
*/
async function initFirebase() {
  if (window.__firebaseInitialized) return window.__firebaseInitialized;
  // dynamic imports
  const [{ initializeApp }, { getFirestore, serverTimestamp, collection, addDoc, doc, setDoc, updateDoc, getDoc } ] = await Promise.all([
    import("https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"),
    import("https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js")
  ]);

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  window.__firebase = { app, db, serverTimestamp, collection, addDoc, doc, setDoc, updateDoc, getDoc };
  window.__firebaseInitialized = true;
  return window.__firebase;
}

/* ====================
   CART & UI UTILITIES
   ==================== */

const $ = (id) => document.getElementById(id);

const currencyFormat = (n) => {
  // assume NGN for display; adapt as needed
  return "₦" + Number(n || 0).toLocaleString();
};

let CART_KEY = "cart_v1";

/* sample product data structure (if user hasn't seeded cart). The original sample used /assets/... references. */
const sampleProducts = [
  { id: "prod_001", name: "Classic Leather Bag", price: 15000, qty: 1, sku: "CLB-001", img: "/assets/bag-1.jpg" },
  { id: "prod_002", name: "Canvas Sneakers", price: 8000, qty: 2, sku: "CS-010", img: "/assets/shoe-1.jpg" }
];

function loadCart() {
  const raw = localStorage.getItem(CART_KEY);
  if (!raw) {
    localStorage.setItem(CART_KEY, JSON.stringify(sampleProducts));
    return sampleProducts.slice();
  }
  try {
    return JSON.parse(raw);
  } catch (e) {
    localStorage.setItem(CART_KEY, JSON.stringify(sampleProducts));
    return sampleProducts.slice();
  }
}

function saveCart(cart) {
  localStorage.setItem(CART_KEY, JSON.stringify(cart));
}

/* UI render cart items */
function renderCart() {
  const cart = window.__cart = loadCart();
  const container = $("cart-list");
  container.innerHTML = "";
  cart.forEach(item => {
    const el = document.createElement("div");
    el.className = "cart-item";
    el.innerHTML = `
      <img src="${item.img || '/assets/placeholder.png'}" alt="${item.name}" />
      <div class="meta">
        <div class="name">${item.name}</div>
        <div class="sku">SKU: ${item.sku}</div>
        <div class="muted" style="margin-top:6px">Unit: ${currencyFormat(item.price)}</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
        <div class="qty-controls" data-id="${item.id}">
          <button class="dec" data-id="${item.id}">-</button>
          <div class="qty">${item.qty}</div>
          <button class="inc" data-id="${item.id}">+</button>
        </div>
        <button class="remove-item" data-id="${item.id}">Remove</button>
      </div>
    `;
    container.appendChild(el);
  });

  // attach events
  container.querySelectorAll(".dec").forEach(btn => btn.addEventListener("click", onQtyDecrease));
  container.querySelectorAll(".inc").forEach(btn => btn.addEventListener("click", onQtyIncrease));
  container.querySelectorAll(".remove-item").forEach(btn => btn.addEventListener("click", onRemoveItem));

  updateSummary();
}

/* quantity handlers */
function onQtyDecrease(e) {
  const id = e.currentTarget.dataset.id;
  let cart = loadCart();
  cart = cart.map(it => it.id === id ? { ...it, qty: Math.max(1, it.qty - 1) } : it);
  saveCart(cart);
  renderCart();
}
function onQtyIncrease(e) {
  const id = e.currentTarget.dataset.id;
  let cart = loadCart();
  cart = cart.map(it => it.id === id ? { ...it, qty: it.qty + 1 } : it);
  saveCart(cart);
  renderCart();
}
function onRemoveItem(e) {
  const id = e.currentTarget.dataset.id;
  let cart = loadCart();
  cart = cart.filter(it => it.id !== id);
  saveCart(cart);
  renderCart();
}

/* Summary calculations */
function calcSubtotal(items) {
  return items.reduce((s,i) => s + (i.price * (i.qty || 1)), 0);
}
function calcTax(amount) {
  // sample VAT 7.5%
  return Math.round(amount * 0.075);
}
function getSelectedDelivery() {
  const active = document.querySelector(".delivery-option.active");
  return { id: active?.dataset?.id || "standard", cost: Number(active?.dataset?.cost || 0) };
}

/* Update summary UI */
function updateSummary() {
  const cart = loadCart();
  const subtotal = calcSubtotal(cart);
  const delivery = getSelectedDelivery().cost;
  const tax = calcTax(subtotal);
  const discount = window.__appliedDiscount || 0;
  const total = subtotal + delivery + tax - discount;

  $("summary-subtotal").textContent = currencyFormat(subtotal);
  $("summary-delivery").textContent = currencyFormat(delivery);
  $("summary-tax").textContent = currencyFormat(tax);
  $("summary-discount").textContent = currencyFormat(discount);
  $("summary-total").textContent = currencyFormat(total);

  window.__orderTotals = { subtotal, delivery, tax, discount, total, currency: "NGN" };
}

/* Delivery selection handling */
function initDeliveryOptions() {
  document.querySelectorAll(".delivery-option").forEach(opt => {
    opt.addEventListener("click", () => {
      document.querySelectorAll(".delivery-option").forEach(o => o.classList.remove("active"));
      opt.classList.add("active");
      updateSummary();
    });
  });
}

/* Promo code logic */
const PROMO_CODES = {
  "SUMMER20": { type: "percent", value: 20 }, // 20% off
  "FLAT1000": { type: "flat", value: 1000 }
};

function applyPromo(code) {
  const normalized = (code || "").trim().toUpperCase();
  const feedback = $("promo-feedback");
  if (!normalized) { feedback.textContent = "Enter a promo code."; feedback.className = "muted"; return; }
  const promo = PROMO_CODES[normalized];
  if (!promo) { feedback.textContent = "Invalid code."; feedback.className = "error"; return; }

  const totals = window.__orderTotals || {};
  let discount = 0;
  if (promo.type === "percent") discount = Math.round((promo.value/100) * (totals.subtotal || 0));
  else discount = promo.value;

  window.__appliedDiscount = discount;
  feedback.textContent = `Applied ${normalized} — Saved ${currencyFormat(discount)}.`;
  feedback.className = "success";
  updateSummary();
}

/* Form validation (basic live feedback) */
function validateField(id, validatorFn, errId) {
  const el = $(id);
  const val = (el.value || "").trim();
  const errEl = $(errId);
  const ok = validatorFn(val);
  errEl.textContent = ok ? "" : `Invalid ${id}`;
  return ok;
}
function validateForm() {
  const checks = [
    validateField("firstName", v => v.length >= 1, "err-firstName"),
    validateField("lastName", v => v.length >= 1, "err-lastName"),
    validateField("email", v => /\S+@\S+\.\S+/.test(v), "err-email"),
    validateField("address", v => v.length >= 4, "err-address"),
    validateField("city", v => v.length >= 2, "err-city"),
    validateField("postcode", v => v.length >= 2, "err-postcode"),
    validateField("phone", v => v.length >= 7, "err-phone")
  ];
  return checks.every(Boolean);
}

/* Modal helpers (simple) */
function showModal(htmlContent) {
  const root = $("modal-root");
  root.innerHTML = `
    <div class="modal-backdrop" id="modal-backdrop">
      <div class="modal">
        ${htmlContent}
      </div>
    </div>
  `;
  root.style.display = "block";
  document.getElementById("modal-backdrop").addEventListener("click", (ev) => {
    if (ev.target.id === "modal-backdrop") closeModal();
  });
}
function closeModal() { const root = $("modal-root"); root.style.display = "none"; root.innerHTML = ""; }

/* ====================
   Payment flow (Flutterwave)
   ==================== */

async function payWithFlutterwave() {
  if (!validateForm()) {
    showModal(`<h3>Validation error</h3><div>Please fix the highlighted fields before proceeding.</div><div class="actions"><button onclick="closeModal()">Close</button></div>`);
    return;
  }

  const totals = window.__orderTotals;
  if (!totals) { alert("Unable to calculate totals."); return; }

  // Build customer & order payload
  const customer = {
    email: $("email").value.trim(),
    phonenumber: $("phone").value.trim(),
    name: ($("firstName").value.trim() + " " + $("lastName").value.trim()).trim()
  };

  const cart = loadCart();

  // Disable pay button while initializing
  const payBtn = $("pay-button");
  payBtn.disabled = true;
  payBtn.textContent = "Initializing...";

  // Flutterwave inline setup
  try {
    // Use tx_ref as a unique ref (you can replace with your own scheme)
    const tx_ref = `tx_${Date.now()}_${Math.floor(Math.random()*10000)}`;

    const paymentOptions = {
      public_key: FLW_PUBLIC_KEY,
      tx_ref: tx_ref,
      amount: totals.total,
      currency: totals.currency || "NGN",
      payment_options: "card,banktransfer,ussd",
      customer,
      customizations: {
        title: "Your Store",
        description: "Order Payment",
        logo: "/assets/logo.png"
      },
      meta: {
        order_data: {
          items: cart,
          subtotal: totals.subtotal,
          delivery: totals.delivery,
          tax: totals.tax,
          discount: totals.discount
        }
      },
      callback: async function (data) {
        // data contains transaction_id / tx_ref / status
        // We will verify server-side
        try {
          showModal(`<h3>Verifying payment</h3><div>Please wait while we verify your payment...</div>`);
          const transaction_id = data.transaction_id || data.id || data.tx_id || data.flw_ref || data.trxref;
          // POST to serverless verify endpoint
          const resp = await fetch("/api/verify-payment", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ transaction_id })
          });
          const json = await resp.json();
          if (json.verified) {
            await onPaymentVerified(json.data, transaction_id, tx_ref);
          } else {
            closeModal();
            showModal(`<h3>Payment not verified</h3><div class="muted">${json.error || 'Verification failed.'}</div><div class="actions"><button onclick="closeModal()">Close</button></div>`);
          }
        } catch (err) {
          closeModal();
          showModal(`<h3>Error</h3><div class="error">${err.message}</div><div class="actions"><button onclick="closeModal()">Close</button></div>`);
        } finally {
          payBtn.disabled = false;
          payBtn.textContent = "Pay with Flutterwave";
        }
      },
      onclose: function() {
        // modal closed by user
        payBtn.disabled = false;
        payBtn.textContent = "Pay with Flutterwave";
      }
    };

    // Launch Flutterwave inline
    getpaidSetup(paymentOptions);

  } catch (err) {
    alert("Payment initialization failed: " + err.message);
    payBtn.disabled = false;
    payBtn.textContent = "Pay with Flutterwave";
  }
}

/* After server-side verification success, write order to Firestore */
async function onPaymentVerified(verificationData, transaction_id, tx_ref) {
  // verificationData should contain keys like status, amount, currency, customer, etc.
  try {
    showModal(`<h3>Saving order</h3><div>Finalizing and saving your order. This will only happen once we confirm the payment.</div>`);
    await initFirebase();
    const { db, serverTimestamp, collection, addDoc } = window.__firebase;

    const orderPayload = {
      user: {
        firstName: $("firstName").value.trim(),
        lastName: $("lastName").value.trim(),
        email: $("email").value.trim(),
        phone: $("phone").value.trim(),
        address: $("address").value.trim(),
        city: $("city").value.trim(),
        postcode: $("postcode").value.trim(),
        country: $("country").value
      },
      items: loadCart(),
      notes: $("order-notes").value.trim(),
      totals: window.__orderTotals,
      payment: {
        verified: true,
        transaction_id: transaction_id,
        tx_ref: tx_ref,
        gateway: "flutterwave",
        raw: verificationData
      },
      createdAt: serverTimestamp()
    };

    // Keep same collection names & field keys as original sample: orders collection
    const ordersRef = collection(db, ORDERS_COLLECTION);
    const docRef = await addDoc(ordersRef, orderPayload);

    // Clear cart after successful order save
    localStorage.removeItem(CART_KEY);
    renderCart(); // re-render empty cart state
    closeModal();
    showModal(`<h3>Payment successful</h3><div>Your payment was verified and order has been placed. Order ID: <strong>${docRef.id}</strong></div><div class="actions"><button onclick="closeModal()">Close</button></div>`);
  } catch (err) {
    closeModal();
    showModal(`<h3>Error saving order</h3><div class="error">${err.message}</div><div class="actions"><button onclick="closeModal()">Close</button></div>`);
  }
}

/* Attach listeners */
function initListeners() {
  // promo apply
  $("apply-promo").addEventListener("click", () => applyPromo($("promo-code").value));

  // pay button
  $("pay-button").addEventListener("click", payWithFlutterwave);

  // live validation on inputs
  ["firstName","lastName","email","address","city","postcode","phone"].forEach(id => {
    const el = $(id);
    if (!el) return;
    el.addEventListener("input", () => {
      // lightweight validators
      if (id === "email") validateField(id, v => /\S+@\S+\.\S+/.test(v), `err-${id}`);
      else validateField(id, v => v.length >= 1, `err-${id}`);
    });
  });
}

/* Initialize default UI state */
async function init() {
  renderCart();
  initDeliveryOptions();
  initListeners();
  updateSummary();
}

/* Run init */
init();

/* Expose closeModal to global scope for modal buttons inline */
window.closeModal = closeModal;

</script>
  
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - FleurDeVie</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #fafafa;
      color: #333;
    }
    header {
      background: #111;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }
    .tabs {
      display: flex;
      background: #222;
    }
    .tabs button {
      flex: 1;
      padding: 1rem;
      background: #222;
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 1rem;
    }
    .tabs button.active {
      background: #444;
      font-weight: bold;
    }
    .tab-content {
      display: none;
      padding: 1.5rem;
      background: #fff;
    }
    .tab-content.active {
      display: block;
    }
    form {
      max-width: 600px;
      margin: auto;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    input, textarea, select, button {
      padding: 0.5rem;
      font-size: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 0.75rem;
      text-align: left;
    }
    th {
      background: #f2f2f2;
    }
    .actions button {
      margin-right: 0.5rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Admin Dashboard - FleurDeVie</h1>
  </header>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tablink active" onclick="openTab(event, 'products')">Products</button>
    <button class="tablink" onclick="openTab(event, 'quotes')">Quotes</button>
    <button class="tablink" onclick="openTab(event, 'orders')">Orders</button>
  </div>

  <!-- Products Tab -->
  <div id="products" class="tab-content active">
    <h2>Manage Products</h2>
    <form id="productForm">
      <input type="text" placeholder="Product Name" required>
      <textarea placeholder="Description"></textarea>
      <input type="number" placeholder="Price" required>
      <label>
        Customization Available?
        <select>
          <option value="no">No</option>
          <option value="yes">Yes</option>
        </select>
      </label>
      <button type="submit">Save Product</button>
    </form>
  </div>

  <!-- Quotes Tab -->
  <div id="quotes" class="tab-content">
    <h2>Create Quote</h2>
    <form id="quoteForm">
      <input type="text" placeholder="Customer Name" required>
      <input type="text" placeholder="Phone Number" required>
      <table id="quoteItems">
        <thead>
          <tr>
            <th>Item</th><th>Quantity</th><th>Price</th><th>Subtotal</th><th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <button type="button" onclick="addQuoteItem()">Add Item</button>
      <h3>Total: <span id="quoteTotal">0</span></h3>
      <button type="submit">Generate Quote</button>
    </form>
  </div>

  <!-- Orders Tab -->
  <div id="orders" class="tab-content">
    <h2>Orders</h2>
    <button onclick="exportOrders()">Export Orders (CSV)</button>
    <table>
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Total</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="ordersBody">
        <tr data-order-id="ORD123"
            data-customer="Jane Doe"
            data-total="15000"
            data-status="Paid"
            data-items='[{"name":"Rose Bouquet","quantity":2,"price":5000},{"name":"Gift Card","quantity":1,"price":5000}]'>
          <td>ORD123</td>
          <td>Jane Doe</td>
          <td>â‚¦15000</td>
          <td>Paid</td>
          <td class="actions"><button>View</button></td>
        </tr>
      </tbody>
    </table>
  </div>

  <script>
    // Tab switching
    function openTab(evt, tabName) {
      document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
      document.querySelectorAll(".tablink").forEach(btn => btn.classList.remove("active"));
      document.getElementById(tabName).classList.add("active");
      evt.currentTarget.classList.add("active");
    }

    // Quote Items logic
    function addQuoteItem() {
      const tbody = document.querySelector("#quoteItems tbody");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><input type="text" placeholder="Item name" required></td>
        <td><input type="number" value="1" min="1" onchange="updateQuoteTotal()"></td>
        <td><input type="number" value="0" min="0" onchange="updateQuoteTotal()"></td>
        <td class="subtotal">0</td>
        <td><button type="button" onclick="this.closest('tr').remove(); updateQuoteTotal();">Remove</button></td>
      `;
      tbody.appendChild(row);
    }

    function updateQuoteTotal() {
      let total = 0;
      document.querySelectorAll("#quoteItems tbody tr").forEach(row => {
        const qty = parseInt(row.querySelector("td:nth-child(2) input").value) || 0;
        const price = parseFloat(row.querySelector("td:nth-child(3) input").value) || 0;
        const subtotal = qty * price;
        row.querySelector(".subtotal").textContent = subtotal;
        total += subtotal;
      });
      document.getElementById("quoteTotal").textContent = total;
    }

    // Export Orders
    function exportOrders() {
      const rows = [];
      const headers = ["Order ID", "Customer", "Product", "Quantity", "Price", "Subtotal", "Order Total", "Status"];
      rows.push(headers.join(","));

      document.querySelectorAll("#ordersBody tr").forEach(tr => {
        const orderId = tr.getAttribute("data-order-id");
        const customer = tr.getAttribute("data-customer");
        const total = tr.getAttribute("data-total");
        const status = tr.getAttribute("data-status");
        const itemsJson = tr.getAttribute("data-items");

        let items = [];
        try {
          items = JSON.parse(itemsJson);
        } catch (e) {
          console.error("Invalid items JSON", e);
        }

        if (items.length > 0) {
          items.forEach(item => {
            rows.push([
              orderId,
              `"${customer}"`,
              `"${item.name}"`,
              item.quantity,
              item.price,
              item.quantity * item.price,
              total,
              status
            ].join(","));
          });
        } else {
          rows.push([orderId, `"${customer}"`, "-", "-", "-", "-", total, status].join(","));
        }
      });

      const csvContent = "data:text/csv;charset=utf-8," + rows.join("\n");
      const link = document.createElement("a");
      link.setAttribute("href", encodeURI(csvContent));
      link.setAttribute("download", "orders.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</body>
</html>

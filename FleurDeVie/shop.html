<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fleur De Vie - Shop</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* RESET & HEADER */
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: "Montserrat", sans-serif; background: #F5E6CC; color:#112e1f; line-height:1.6; }
a { text-decoration:none; color:inherit; }
.site-header { background: #112e1f; color: #F5E6CC; display:flex; justify-content:space-between; align-items:center; padding:16px 28px; position:fixed; top:0; left:0; right:0; z-index:1000; }
.header-left { display:flex; align-items:center; gap:12px; }
.brand-logo { height:60px; }
.brand-title { font-family:"Playfair Display", serif; font-size:24px; font-weight:700; }
.header-right { display:flex; gap:20px; align-items:center; }
.header-right a { font-weight:500; transition: color 0.3s; }
.header-right a:hover { color:#FFD6BA; }
.cart-count { background:#FFD6BA; color:#112e1f; font-size:12px; font-weight:600; border-radius:50%; padding:2px 6px; margin-left:4px; }
.hamburger { display:none; background:none; border:none; cursor:pointer; width:30px; height:24px; position:relative; }
.hamburger span { display:block; width:100%; height:3px; background:#F5E6CC; border-radius:2px; position:absolute; left:0; transition:0.3s; }
.hamburger span:nth-child(1){ top:0; }
.hamburger span:nth-child(2){ top:10px; }
.hamburger span:nth-child(3){ top:20px; }
.hamburger.open span:nth-child(1){ transform:rotate(45deg); top:10px; }
.hamburger.open span:nth-child(2){ opacity:0; }
.hamburger.open span:nth-child(3){ transform:rotate(-45deg); top:10px; }

/* HERO */
.hero { position: relative; height:50vh; display:flex; justify-content:center; align-items:center; text-align:center; margin-top:80px; overflow:hidden; }
.hero::after { content:""; position:absolute; inset:0; background:url('bg.jpg') center/cover no-repeat; transform:scale(1.1); z-index:-1; border-radius:12px; box-shadow: inset 0 0 0 2000px rgba(17,46,31,0.3); }
.hero-text { position:relative; display:inline-block; color:#FFD6BA; margin-bottom:12px; animation: shimmer 3s infinite linear; }
.hero-text h1 { font-family:"Playfair Display", serif; font-size:clamp(36px,5vw,64px); margin-bottom:12px; }
.hero-text p { font-size:clamp(16px,2vw,24px); max-width:700px; }

/* SEARCH + SORT + CURRENCY */
.shop-controls { display:flex; justify-content:space-between; flex-wrap:wrap; margin-bottom:20px; gap:10px; align-items:center; }
.shop-controls input,
.shop-controls select { padding:8px; border-radius:6px; border:1px solid #112e1f; font-size:14px; flex:1; max-width:300px; } 
.currency-filter-group { display:flex; gap:10px; align-items:center; flex:1; max-width:300px; }

/* SHOP GRID */
section.shop { padding:80px 20px; background:#F5E6CC; }
.container { max-width:1100px; margin:auto; }
h2 { text-align:center; font-size:24px; font-family:"Playfair Display", serif; margin-bottom:40px; }

.product-grid { display:grid; gap:20px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
.product-card { background:#FFD6BA; padding:16px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); display:flex; flex-direction:column; transition: transform 0.2s; cursor:pointer; position:relative; }
.product-card:hover { transform: translateY(-5px); }
.product-card img { width:100%; height:180px; object-fit: contain; border-radius:8px; margin-bottom:12px; background: #fff; }
.product-card h3 { font-family:"Playfair Display", serif; font-size:1.1rem; margin-bottom:6px; }
.product-card .description { font-size:0.9rem; color:#112e1f; margin-bottom:8px; }
.product-card .price { font-weight:600; margin-bottom:12px; }
.product-card button { background:#112e1f; color:#F5E6CC; border:none; border-radius:6px; padding:10px; cursor:pointer; transition:0.3s; }
.product-card button:hover { background:#0a1d14; }
.quantity-controls { display:flex; gap:10px; align-items:center; margin-bottom:8px; }
.quantity-badge { font-weight:600; }

/* CUSTOMIZE BUTTON */
.customize-badge { position:absolute; top:10px; right:10px; background:#FFD6BA; color:#112e1f; font-size:12px; padding:6px 10px; border-radius:8px; font-weight:600; cursor:pointer; z-index:2; display:flex; align-items:center; gap:4px; box-shadow:0 2px 6px rgba(0,0,0,0.2); border:2px solid #112e1f; transition:0.2s; }
.customize-badge:hover { background:#112e1f; color:#FFD6BA; }

/* FOOTER */
footer { text-align:center; padding:20px; background:#112e1f; color:#F5E6CC; margin-top:60px; }

/* MEDIA */
@media(max-width:900px){ .product-grid { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); } }
@media(max-width:600px){
  .product-grid { grid-template-columns: repeat(2, 1fr); }
  .product-card img { height:140px; }
  .header-right { display:none; flex-direction:column; background:#112e1f; position:absolute; top:70px; right:0; width:200px; padding:20px; }
  .header-right.open { display:flex; }
  .hamburger { display:block; }
  .mobile-cart { display:flex; align-items:center; margin-right:10px; }
  .mobile-cart a { color:#FFD6BA; font-size:20px; position:relative; }
  .mobile-cart .cart-count { position:absolute; top:-8px; right:-8px; }
  .customize-badge { font-size:14px; padding:8px 12px; }
  .hero { height:30vh; margin-top:0; padding-top:80px; } 
  .hero-text h1 { font-size:clamp(24px,5vw,32px); line-height:1.2; margin:0; }
  .hero-text p { font-size:clamp(14px,2.5vw,18px); margin:0 auto; }
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="site-header">
  <div class="header-left">
    <img src="logo.png" alt="Fleur De Vie Logo" class="brand-logo">
    <div class="brand-title">Fleur De Vie</div>
  </div>
  <div class="mobile-cart" style="display:none;">
    <a href="cart.html"><i class="fa-solid fa-cart-shopping"></i><span class="cart-count" id="cartCountMobile">0</span></a>
  </div>
  <nav class="header-right">
    <a href="index.html">Home</a>
    <a href="about.html">About</a>
    <a href="cart.html">Cart <span class="cart-count" id="cartCount">0</span></a>
    <a href="customization.html">Customize</a>
    <a href="contact.html">Contact</a>
  </nav>
  <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
</header>

<!-- HERO -->
<section class="hero">
  <div class="hero-text">
    <h1>Shop</h1>
    <p>Explore our collection of products</p>
  </div>
</section>

<!-- SHOP -->
<section class="shop">
  <div class="container">
    <h2>Our Products</h2>
    <div class="shop-controls">
      <input type="text" id="searchInput" placeholder="Search products...">
      <div class="currency-filter-group">
        <select id="currencySelect">
          <option value="NGN">NGN</option>
          <option value="USD">USD</option>
          <option value="EUR">EUR</option>
          <option value="GBP">GBP</option>
        </select>
        <select id="sortSelect">
          <option value="">Filter / Sort</option>
          <option value="alphabet">Alphabet</option>
          <option value="price-asc">Price: Low → High</option>
          <option value="price-desc">Price: High → Low</option>
        </select>
      </div>
    </div>
    <div class="product-grid" id="productGrid"></div>
  </div>
</section>

<!-- FOOTER -->
<footer>
  <p>© 2025 Fleur De Vie</p>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCuiZXHFYl1fVKnGwojavRvbekSBpkipJg",
  authDomain: "brandisby.firebaseapp.com",
  projectId: "brandisby",
  storageBucket: "brandisby.firebasestorage.app",
  messagingSenderId: "87213267039",
  appId: "1:87213267039:web:339e9fd49e3ad31f7423ea"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const productGrid = document.getElementById('productGrid');
const cartCountElem = document.getElementById('cartCount');
const cartCountMobileElem = document.getElementById('cartCountMobile');
const searchInput = document.getElementById('searchInput');
const sortSelect = document.getElementById('sortSelect');
const currencySelect = document.getElementById('currencySelect');

function getCart(){ return JSON.parse(localStorage.getItem('cart')) || []; }
function setCart(cart){ localStorage.setItem('cart', JSON.stringify(cart)); updateCartCount(); }
function updateCartCount(){
  const cart = getCart();
  const total = cart.reduce((sum,i)=>sum+i.quantity,0);
  cartCountElem.textContent = total;
  cartCountMobileElem.textContent = total;
}

function addToCart(product){
  let cart = getCart();
  const idx = cart.findIndex(i=>i.id===product.id);
  if(idx>-1) cart[idx].quantity+=1; else cart.push({...product,quantity:1});
  setCart(cart);
  updateProductUI(product.id);
}

function removeFromCart(productId){
  let cart = getCart();
  const idx = cart.findIndex(i=>i.id===productId);
  if(idx>-1){ cart[idx].quantity-=1; if(cart[idx].quantity<=0) cart.splice(idx,1);}
  setCart(cart);
  updateProductUI(productId);
}

function updateProductUI(productId){
  const cart = getCart();
  const item = cart.find(i=>i.id===productId);
  const card = document.getElementById(`product-${productId}`);
  if(!card) return;
  const addBtn = card.querySelector('.add-cart');
  const badge = card.querySelector('.quantity-badge');
  if(item){ addBtn.style.display='none'; badge.textContent=item.quantity; } else { addBtn.style.display='block'; badge.textContent=''; }
}

async function loadProducts(){
  try{
    const q = query(collection(db,"brands","fleurdevie","products"), where("published","==",true));
    const snapshot = await getDocs(q);
    const products = [];
    snapshot.forEach(doc=>{
      const data = doc.data();
      if(!data.name || (!data.priceNGN && !data.priceUSD && !data.priceEUR && !data.priceGBP) || !data.imageUrl) return;
      products.push({id:doc.id,...data});
    });
    displayProducts(products);
  } catch(e){
    console.error(e);
    productGrid.innerHTML='<p style="text-align:center;color:red;">Failed to load products.</p>';
  }
}

function displayProducts(products){
  const term = searchInput.value.toLowerCase();
  let filtered = products.filter(p=>p.name.toLowerCase().includes(term));
  const sortVal = sortSelect.value;

  // Sorting
  if(sortVal==='alphabet') filtered.sort((a,b)=>a.name.localeCompare(b.name));
  if(sortVal==='price-asc') filtered.sort((a,b)=>{
    return getPriceForCurrency(a,currencySelect.value) - getPriceForCurrency(b,currencySelect.value);
  });
  if(sortVal==='price-desc') filtered.sort((a,b)=>{
    return getPriceForCurrency(b,currencySelect.value) - getPriceForCurrency(a,currencySelect.value);
  });

  productGrid.innerHTML='';
  const cart = getCart();
  const localeMap = { NGN:'en-NG', USD:'en-US', EUR:'de-DE', GBP:'en-GB' };

  for(const p of filtered){
    const cartItem = cart.find(i=>i.id===p.id);
    const quantity = cartItem ? cartItem.quantity : 0;
    const price = getPriceForCurrency(p, currencySelect.value);
    const priceFormatted = new Intl.NumberFormat(localeMap[currencySelect.value], { style:'currency', currency:currencySelect.value, minimumFractionDigits: currencySelect.value==='NGN'?0:2 }).format(price);

    const div = document.createElement('div');
    div.className='product-card';
    div.id=`product-${p.id}`;
    div.innerHTML=`
      ${p.customizationAvailable ? `<div class="customize-badge"><i class="fa-solid fa-wand-magic-sparkles"></i> Customize</div>` : ''}
      <img src="${p.imageUrl}" alt="${p.name}">
      <h3>${p.name}</h3>
      <div class="description">${truncateText(p.description||'', 15)}</div>
      <div class="price">${priceFormatted}</div>
      <div class="quantity-controls">
        <button class="minus">-</button>
        <span class="quantity-badge">${quantity>0 ? quantity : ''}</span>
        <button class="plus">+</button>
      </div>
      <button class="add-cart" style="display:${quantity>0?'none':'block'};">Add to Cart</button>
    `;

    div.querySelector('.plus').addEventListener('click', e=>{ e.stopPropagation(); addToCart(p); });
    div.querySelector('.minus').addEventListener('click', e=>{ e.stopPropagation(); removeFromCart(p.id); });
    div.querySelector('.add-cart').addEventListener('click', e=>{ e.stopPropagation(); addToCart(p); });

    productGrid.appendChild(div);
  }
}

function getPriceForCurrency(product, currency){
  if(currency==='NGN') return product.priceNGN||0;
  if(currency==='USD') return product.priceUSD||0;
  if(currency==='EUR') return product.priceEUR||0;
  if(currency==='GBP') return product.priceGBP||0;
  return product.priceNGN||0;
}

function truncateText(text, wordLimit){ return text.split(' ').slice(0,wordLimit).join(' '); }

searchInput.addEventListener('input',()=>loadProducts());
sortSelect.addEventListener('change',()=>loadProducts());
currencySelect.addEventListener('change',()=>loadProducts());

// Hamburger & mobile cart
document.getElementById('hamburger').addEventListener('click',()=>{
  document.querySelector('.header-right').classList.toggle('open');
  document.getElementById('hamburger').classList.toggle('open');
});
function handleMobileCart(){ document.querySelector('.mobile-cart').style.display=window.innerWidth<=600?'flex':'none'; }
window.addEventListener('resize', handleMobileCart);
handleMobileCart();

updateCartCount();
loadProducts();
window.addEventListener('storage', updateCartCount);

// Optional: set default currency based on localStorage or IP
const savedCurrency = localStorage.getItem('currency');
if(savedCurrency) currencySelect.value = savedCurrency;
currencySelect.addEventListener('change', ()=>localStorage.setItem('currency', currencySelect.value));
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sérac - Product</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root{
  --bg:#141517;        /* primary background */
  --bg-2:#4B4E54;      /* secondary dark */
  --accent:#B66E41;    /* golden accent */
  --muted:#9aa0a4;     /* muted text */
  --surface:#1b1c1d;   /* surface panels */
  --radius:12px;
  --transition:200ms cubic-bezier(.2,.8,.2,1);
}

/* Reset */
* { margin:0; padding:0; box-sizing:border-box; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
html,body { height:100%; }
body {
  font-family: "Montserrat", sans-serif;
  background: linear-gradient(180deg,var(--bg) 0%, #0f1011 100%);
  color: #E7E7E7;
  line-height:1.6;
  -webkit-font-smoothing:antialiased;
  padding-top:84px; /* keep space for fixed header */
}

/* Basic links */
a { text-decoration:none; color:inherit; }
img { display:block; max-width:100%; }

/* HEADER */
.site-header {
  background: linear-gradient(90deg, rgba(0,0,0,0.25), rgba(0,0,0,0.15));
  color: #E7E7E7;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 28px;
  position:fixed;
  top:0; left:0; right:0;
  z-index:1100;
  backdrop-filter: blur(6px);
  border-bottom:1px solid rgba(255,255,255,0.03);
}
.header-left { display:flex; align-items:center; gap:14px; }
.brand-logo { height:56px; width:auto; object-fit:contain; filter: none; }
.brand-title {
  font-family:"Playfair Display", serif;
  font-size:22px;
  font-weight:700;
  letter-spacing:0.4px;
  color:#FFFFFF;
}
.header-right { display:flex; gap:20px; align-items:center; }
.header-right a {
  font-weight:500;
  color:var(--muted);
  padding:8px 10px;
  border-radius:8px;
  transition: color var(--transition), transform var(--transition);
}
.header-right a:hover { color:var(--accent); transform:translateY(-2px); }
.cart-count {
  background:var(--accent);
  color:#111;
  font-size:12px;
  font-weight:700;
  border-radius:999px;
  padding:4px 7px;
  margin-left:6px;
  display:inline-block;
  box-shadow: 0 6px 18px rgba(182,110,65,0.12);
}

/* Hamburger */
.hamburger { display:none; background:none; border:none; cursor:pointer; width:36px; height:24px; position:relative; }
.hamburger span { display:block; width:100%; height:3px; background:#DADADA; border-radius:3px; position:absolute; left:0; transition: transform var(--transition), opacity var(--transition), top var(--transition); }
.hamburger span:nth-child(1){ top:0; }
.hamburger span:nth-child(2){ top:10px; }
.hamburger span:nth-child(3){ top:20px; }
.hamburger.open span:nth-child(1){ transform:rotate(45deg); top:10px; }
.hamburger.open span:nth-child(2){ opacity:0; }
.hamburger.open span:nth-child(3){ transform:rotate(-45deg); top:10px; }

/* MAIN / PRODUCT */
main {
  padding:24px;
  max-width:1100px;
  margin:0 auto 48px;
  display:flex;
  gap:40px;
  flex-wrap:wrap;
  justify-content:center;
  align-items:flex-start;
}

/* Left - product image area */
.product-image {
  flex:1 1 360px;
  max-width:460px;
  display:flex;
  flex-direction:column;
  gap:14px;
  align-items:stretch;
}
.product-image img {
  width:100%;
  object-fit:cover;
  border-radius:var(--radius);
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  box-shadow: 0 10px 30px rgba(2,2,2,0.7), inset 0 -2px 6px rgba(0,0,0,0.4);
  cursor:pointer;
  transition: transform var(--transition), box-shadow var(--transition);
}
.product-image img:hover { transform: translateY(-6px) scale(1.01); box-shadow: 0 18px 42px rgba(0,0,0,0.7); }

.thumbnail-container {
  display:flex;
  gap:10px;
  overflow-x:auto;
  scroll-behavior:smooth;
  -webkit-overflow-scrolling: touch;
  padding-bottom:6px;
}
.thumbnail-container img {
  width:72px;
  height:72px;
  object-fit:cover;
  border-radius:10px;
  border:2px solid transparent;
  cursor:pointer;
  flex-shrink:0;
  transition: border-color var(--transition), transform var(--transition);
  background:var(--surface);
}
.thumbnail-container img:hover { transform:translateY(-4px); }
.thumbnail-container img.selected { border-color:var(--accent); box-shadow: 0 6px 18px rgba(182,110,65,0.12); }

/* Right - product details */
.product-details {
  flex:1 1 360px;
  max-width:520px;
  display:flex;
  flex-direction:column;
  gap:12px;
  align-items:flex-start;
}
.product-details h1 {
  font-family:"Playfair Display", serif;
  font-size:28px;
  color:#FFFFFF;
  letter-spacing:0.2px;
}
.product-details .description {
  font-size:15px;
  color:var(--muted);
  line-height:1.5;
}
.product-details .price {
  font-weight:700;
  font-size:20px;
  color:#FFFFFF;
  margin-bottom:6px;
}

/* options */
.options-container {
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-bottom:6px;
}
.options-container button {
  padding:10px 14px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.04);
  cursor:pointer;
  background:transparent;
  color:var(--muted);
  font-weight:500;
  transition: background var(--transition), color var(--transition), transform var(--transition);
  box-shadow: 0 4px 14px rgba(0,0,0,0.5);
}
.options-container button:hover { transform:translateY(-4px); color:#fff; border-color: rgba(182,110,65,0.18); }
.options-container button.selected {
  background: linear-gradient(180deg, rgba(182,110,65,0.12), rgba(182,110,65,0.06));
  color:#fff;
  border-color:var(--accent);
}

/* quantity controls */
.quantity-controls {
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:12px;
}
.quantity-controls button {
  background:transparent;
  color:#fff;
  border:1px solid rgba(255,255,255,0.06);
  border-radius:10px;
  padding:10px 14px;
  cursor:pointer;
  font-weight:700;
  transition: background var(--transition), transform var(--transition);
}
.quantity-controls button:hover { background: rgba(255,255,255,0.03); transform:translateY(-3px); }
.quantity-badge {
  font-weight:700;
  min-width:36px;
  text-align:center;
  display:inline-block;
  color:var(--muted);
}

/* primary and secondary CTA styles */
.add-cart {
  background: linear-gradient(90deg, var(--accent), #a85a35);
  color:#111;
  border:none;
  border-radius:12px;
  padding:14px 18px;
  cursor:pointer;
  font-size:1rem;
  transition: transform var(--transition), box-shadow var(--transition);
  box-shadow: 0 8px 26px rgba(182,110,65,0.12);
}
.add-cart:hover { transform:translateY(-4px); box-shadow: 0 18px 48px rgba(182,110,65,0.18); }

.customize-btn {
  background:transparent;
  color:var(--accent);
  border:1px dashed rgba(182,110,65,0.22);
  border-radius:10px;
  padding:12px 14px;
  cursor:pointer;
  font-weight:700;
  text-align:center;
  transition: background var(--transition), color var(--transition), transform var(--transition);
}
.customize-btn:hover { background: rgba(182,110,65,0.04); transform:translateY(-3px); color:#fff; }

/* Buttons row for desktop + sticky mobile container */
.buttons-row { display:flex; gap:12px; margin-top:8px; align-items:center; width:100%; }
.back-btn {
  background:transparent;
  color:var(--muted);
  border:1px solid rgba(255,255,255,0.04);
  border-radius:10px;
  padding:12px;
  cursor:pointer;
  font-size:0.98rem;
  font-weight:600;
  transition: color var(--transition), transform var(--transition);
}
.back-btn:hover { color:#fff; transform:translateY(-3px); }

/* mobile actions (fixed) */
.mobile-actions { display:none; }

/* FOOTER */
footer {
  text-align:center;
  padding:28px 14px;
  color:var(--muted);
  margin-top:40px;
  border-top:1px solid rgba(255,255,255,0.03);
  background:transparent;
  font-size:14px;
}

/* RESPONSIVE */
@media(max-width:1000px){
  main { padding:18px; gap:28px; }
  .product-image, .product-details { max-width:100%; }
}
@media(max-width:800px){
  main { flex-direction:column; align-items:center; padding-bottom:92px; }
}
@media(max-width:600px){
  .header-right { display:none; flex-direction:column; background:var(--bg-2); position:absolute; top:72px; right:12px; width:220px; padding:16px; border-radius:10px; box-shadow: 0 12px 36px rgba(0,0,0,0.6); }
  .header-right.open { display:flex; }
  .hamburger { display:block; }

  .mobile-actions {
    display:flex;
    position:fixed;
    bottom:18px;
    left:50%;
    transform:translateX(-50%);
    width:92%;
    max-width:640px;
    z-index:999;
    gap:10px;
    justify-content:center;
    padding:10px;
    background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:14px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.6);
  }
  .mobile-actions .back-btn { flex:1; text-align:center; }
}
</style>
</head>
<body>

<header class="site-header">
  <div class="header-left">
    <img src="serac-logo.png" alt="Sérac Logo" class="brand-logo">
    <div class="brand-title">Sérac</div>
  </div>
  <nav class="header-right">
    <a href="index.html">Home</a>
    <a href="shop.html">Shop</a>
    <a href="about.html">About</a>
    <a href="cart.html">Cart <span class="cart-count" id="cartCount">0</span></a>
    <a href="customization.html">Customize</a>
    <a href="contact.html">Contact</a>
  </nav>
  <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
</header>

<main id="productContainer">
  <div class="product-image">
    <img id="productImg" src="" alt="Product Image">
    <div class="thumbnail-container" id="thumbnailContainer"></div>
  </div>
  <div class="product-details">
    <h1 id="productName">Product Name</h1>
    <div class="description" id="productDescription">Product description will appear here.</div>
    <div class="price" id="productPrice">₦0.00</div>

    <div class="options-container" id="colorOptions"></div>
    <div class="options-container" id="sizeOptions"></div>

    <div class="quantity-controls">
      <button id="minus">-</button>
      <span class="quantity-badge" id="quantityBadge">0</span>
      <button id="plus">+</button>
    </div>

    <button class="add-cart" id="addCartBtn">Add to Cart</button>

    <a href="customization.html" id="customizeBtn" class="customize-btn" style="display:none;">Customize this Product</a>

    <div class="buttons-row" style="margin-bottom:12px;">
      <a href="shop.html" class="back-btn" id="backBtnDesktop">← Back to Shop</a>
    </div>

    <div class="mobile-actions" id="mobileActions" aria-hidden="true">
      <a href="shop.html" class="back-btn">← Back to Shop</a>
    </div>
  </div>
</main>

<footer>
  <p>© 2025 Sérac</p>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCuiZXHFYl1fVKnGwojavRvbekSBpkipJg",
  authDomain: "brandisby.firebaseapp.com",
  projectId: "brandisby",
  storageBucket: "brandisby.firebasestorage.app",
  messagingSenderId: "87213267039",
  appId: "1:87213267039:web:339e9fd49e3ad31f7423ea"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const productImg = document.getElementById('productImg');
const productName = document.getElementById('productName');
const productDescription = document.getElementById('productDescription');
const productPrice = document.getElementById('productPrice');
const quantityBadge = document.getElementById('quantityBadge');
const addCartBtn = document.getElementById('addCartBtn');
const minusBtn = document.getElementById('minus');
const plusBtn = document.getElementById('plus');
const cartCountElem = document.getElementById('cartCount');
const customizeBtn = document.getElementById('customizeBtn');
const thumbnailContainer = document.getElementById('thumbnailContainer');
const colorOptions = document.getElementById('colorOptions');
const sizeOptions = document.getElementById('sizeOptions');

let currentProductData = null;

/* CART helpers — UPDATED STORAGE KEYS */
const STORAGE_KEY = 'seracCart';
const CURRENCY_KEY = 'seracCurrency';

function getCart(){ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
function setCart(cart){ localStorage.setItem(STORAGE_KEY, JSON.stringify(cart)); updateCartCount(); }
function updateCartCount(){
  const cart = getCart();
  cartCountElem.textContent = cart.reduce((sum,item)=>sum+Number(item.quantity||0),0);
}

/* Sum all variants for this product */
function updateQuantityUI(productId){
  const cart = getCart();
  const totalQuantity = cart.filter(i=>i.id===productId).reduce((sum,i)=>sum+Number(i.quantity||0),0);
  quantityBadge.textContent = totalQuantity;
  addCartBtn.style.display = totalQuantity > 0 ? 'none' : 'block';
}

/* add and remove */
function addToCart(product){
  let cart = getCart();
  const index = cart.findIndex(i=>i.id===product.id && (i.color||'')=== (product.color||'') && (i.size||'') === (product.size||''));
  if(index > -1){
    cart[index].quantity = Number(cart[index].quantity || 0) + 1;
  } else {
    cart.push({...product, quantity:1});
  }
  setCart(cart);
  updateQuantityUI(product.id);
}
function removeFromCart(productId){
  let cart = getCart();
  const sel = getSelectedOptions();
  const index = cart.findIndex(i=>i.id===productId && (i.color||'')=== (sel.color||'') && (i.size||'') === (sel.size||''));
  if(index > -1){
    cart[index].quantity = Number(cart[index].quantity || 0) - 1;
    if(cart[index].quantity <= 0){ cart.splice(index,1); }
    setCart(cart);
  }
  updateQuantityUI(productId);
}

/* URL params */
const urlParams = new URLSearchParams(window.location.search);
const productId = urlParams.get('productId');
const urlPrice = parseFloat(urlParams.get('price'));
const urlCurrency = urlParams.get('currency');

/* Load product */
async function loadProduct(){
  if(!productId) return;
  try{
    const docRef = doc(db,"brands","serac","products",productId);
    const docSnap = await getDoc(docRef);
    if(docSnap.exists()){
      const data = docSnap.data();
      currentProductData = data;

      const images = Array.isArray(data.images) && data.images.length
        ? data.images.filter(Boolean)
        : (data.imageUrl ? [data.imageUrl] : []);
      productImg.src = images[0] || '';
      thumbnailContainer.innerHTML = '';
      images.forEach((imgUrl, idx)=>{
        if(!imgUrl) return;
        const thumb = document.createElement('img');
        thumb.src = imgUrl;
        if(idx===0) thumb.classList.add('selected');
        thumb.addEventListener('click', ()=>{
          productImg.src = imgUrl;
          thumbnailContainer.querySelectorAll('img').forEach(i=>i.classList.remove('selected'));
          thumb.classList.add('selected');
        });
        thumbnailContainer.appendChild(thumb);
      });

      productName.textContent = data.name || '';
      productDescription.textContent = data.description || '';

      const displayPrice = !isNaN(urlPrice) ? urlPrice : (data.price || 0);
      const displayCurrency = urlCurrency || data.currency || 'NGN';
      const localeMap = { NGN:'en-NG', USD:'en-US', EUR:'de-DE', GBP:'en-GB' };
      const minFrac = displayCurrency === 'NGN' ? 0 : 2;
      try {
        productPrice.textContent = new Intl.NumberFormat(localeMap[displayCurrency] || 'en-US', { style:'currency', currency: displayCurrency, minimumFractionDigits: minFrac }).format(displayPrice);
      } catch(e) {
        productPrice.textContent = `${displayCurrency} ${displayPrice}`;
      }
      currentProductData.price = displayPrice;
      currentProductData.currency = displayCurrency;

      if(data.customizationAvailable){
        customizeBtn.style.display='block';
        customizeBtn.href=`customization.html?productId=${productId}`;
      } else { customizeBtn.style.display='none'; }

      colorOptions.innerHTML='';
      if(Array.isArray(data.colors) && data.colors.length){
        data.colors.forEach(c=>{
          const btn = document.createElement('button'); btn.textContent=c;
          btn.addEventListener('click',()=>{
            Array.from(colorOptions.children).forEach(b=>b.classList.remove('selected'));
            btn.classList.add('selected');
            updateQuantityUI(productId);
          });
          colorOptions.appendChild(btn);
        });
      }

      sizeOptions.innerHTML='';
      if(Array.isArray(data.sizes) && data.sizes.length){
        data.sizes.forEach(s=>{
          const btn = document.createElement('button'); btn.textContent=s;
          btn.addEventListener('click',()=>{
            Array.from(sizeOptions.children).forEach(b=>b.classList.remove('selected'));
            btn.classList.add('selected');
            updateQuantityUI(productId);
          });
          sizeOptions.appendChild(btn);
        });
      }

      updateQuantityUI(productId);

    } else {
      document.getElementById('productContainer').innerHTML='<p style="text-align:center; color:#d9534f;">Product not found.</p>';
    }
  } catch(err){
    console.error(err);
    document.getElementById('productContainer').innerHTML='<p style="text-align:center; color:#d9534f;">Failed to load product.</p>';
  }
}

/* selection */
function getSelectedOptions(){
  return {
    color: colorOptions.querySelector('.selected')?.textContent || '',
    size: sizeOptions.querySelector('.selected')?.textContent || ''
  };
}

/* Cart button handlers */
addCartBtn.addEventListener('click', ()=> {
  if(!currentProductData) return;
  const sel = getSelectedOptions();
  addToCart({ id: productId, name: currentProductData.name, price: currentProductData.price, currency: currentProductData.currency, imageUrl: productImg.src, color: sel.color, size: sel.size });
});
plusBtn.addEventListener('click', ()=> {
  if(!currentProductData) return;
  const sel = getSelectedOptions();
  addToCart({ id: productId, name: currentProductData.name, price: currentProductData.price, currency: currentProductData.currency, imageUrl: productImg.src, color: sel.color, size: sel.size });
});
minusBtn.addEventListener('click', ()=> { removeFromCart(productId); });

/* Hamburger */
document.getElementById('hamburger').addEventListener('click', ()=>{
  document.querySelector('.header-right').classList.toggle('open');
  document.getElementById('hamburger').classList.toggle('open');
});

/* Thumbnails swipe */
let isDown=false, startX, scrollLeft;
const thumbnailContainerEl = thumbnailContainer;
thumbnailContainerEl.addEventListener('mousedown', e=>{ isDown=true; startX=e.pageX - thumbnailContainerEl.offsetLeft; scrollLeft=thumbnailContainerEl.scrollLeft; });
thumbnailContainerEl.addEventListener('mouseleave', ()=>{ isDown=false; });
thumbnailContainerEl.addEventListener('mouseup', ()=>{ isDown=false; });
thumbnailContainerEl.addEventListener('mousemove', e=>{ if(!isDown)return; e.preventDefault(); const x=e.pageX - thumbnailContainerEl.offsetLeft; const walk=(x-startX)*2; thumbnailContainerEl.scrollLeft=scrollLeft-walk; });

window.addEventListener('storage', ()=>{ updateCartCount(); updateQuantityUI(productId); });
updateCartCount();
loadProduct();
</script>

</body>
</html>

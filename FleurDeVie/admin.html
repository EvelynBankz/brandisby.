<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fleur De Vie Admin Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing:border-box; margin:0; padding:0; }
    body { font-family: "Montserrat", sans-serif; background:#F5E6CC; color:#112e1f; line-height:1.6; }
    a { text-decoration:none; color:inherit; }

    header { background:#112e1f; color:#FFD6BA; padding:16px; text-align:center; font-family:"Playfair Display", serif; font-size:24px; font-weight:700; }

    .container { max-width:1000px; margin:2rem auto; padding:2rem; background:#FFD6BA; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }

    h2 { font-family:"Playfair Display", serif; margin-bottom:16px; color:#112e1f; }

    label { display:block; margin-top:1rem; font-weight:500; }
    input, textarea, select { width:100%; padding:0.6rem; margin-top:0.5rem; border:1px solid #112e1f; border-radius:6px; font-size:1rem; }

    button { margin-top:1rem; padding:0.75rem 1.2rem; background:#112e1f; color:#FFD6BA; border:none; border-radius:6px; cursor:pointer; font-weight:600; transition:0.3s; }
    button:hover { background:#0a1d14; }

    .message { margin-top:1rem; font-weight:500; font-size:1rem; text-align:center; }

    table { width:100%; border-collapse:collapse; margin-top:1.5rem; background:#fff; border-radius:12px; overflow:hidden; }
    th, td { padding:0.75rem; border-bottom:1px solid #ddd; text-align:left; font-size:0.95rem; vertical-align:top; }
    th { background:#F5E6CC; font-family:"Playfair Display", serif; color:#112e1f; }
    td img { width:60px; border-radius:6px; }

    .actions button { margin-right:0.5rem; padding:0.4rem 0.6rem; font-size:0.9rem; }
    .actions button:hover { opacity:0.85; }

    .small-note { font-size:0.9rem; color:#334d3a; margin-top:8px; }

    /* Dashboard Navigation */
    .dashboard-nav { display:flex; gap:10px; margin-bottom:1.5rem; }
    .dashboard-nav button { flex:1; }
    .section { display:none; margin-top:1rem; }
    .section.active { display:block; }

    .details-row { background:#fff6e8; }
    .details-row td { padding:12px; }

    /* Orders filter/search */
    .order-filters { display:flex; gap:10px; margin-bottom:1rem; flex-wrap:wrap; }
    .order-filters input, .order-filters select { flex:1; max-width: 320px; }

    .quote-item { border:1px solid #eee; padding:8px; margin-top:8px; background:#fff; border-radius:6px; }

    .copy-btn { background:none; border:none; cursor:pointer; margin-left:6px; font-size:1rem; }
    .copy-btn:hover { opacity:0.7; }

    @media(max-width:600px){
      .container { padding:1rem; }
      table, th, td { font-size:0.85rem; }
      th, td { padding:0.5rem; }
      .dashboard-nav { flex-direction:column; }
      .order-filters { flex-direction: column; }
    }

    /* Add Item panel styling (small) */
    .add-item-panel { border:1px dashed rgba(17,46,31,0.12); padding:12px; margin-top:8px; background:#fff; border-radius:8px; }
    .inline-grid { display:grid; grid-template-columns: repeat(4,1fr); gap:8px; }
    @media(max-width:600px){ .inline-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

<header>Fleur De Vie Admin Dashboard</header>

<div class="container" id="loginContainer">
  <h2>Admin Login</h2>
  <form id="loginForm">
    <label for="loginEmail">Email</label>
    <input type="email" id="loginEmail" required>
    <label for="loginPassword">Password</label>
    <input type="password" id="loginPassword" required>
    <button type="submit">Login</button>
    <div class="message" id="loginMessage"></div>
  </form>
</div>

<div class="container" id="dashboardContainer" style="display:none;">
  <div class="dashboard-nav">
    <button type="button" data-target="productsSection">ðŸ“¦ Products</button>
    <button type="button" data-target="quotesSection">ðŸ’³ Quotes</button>
    <button type="button" data-target="ordersSection">ðŸ§¾ Orders</button>
  </div>

  <!-- PRODUCTS -->
  <div class="section" id="productsSection">
    <h2>Manage Products</h2>
    <!-- Product form and table remain unchanged -->
    <!-- ... existing products code ... -->
  </div>

  <!-- QUOTES -->
  <div class="section" id="quotesSection">
    <h2>Generate Quote</h2>
    <form id="quoteForm">
      <label>Customer Name</label>
      <input type="text" id="quoteCustomer" required>
      <label>Customer Email</label>
      <input type="email" id="quoteEmail" required>

      <label>Quote Currency (primary)</label>
      <select id="quoteCurrency">
        <option value="NGN">NGN</option>
        <option value="USD">USD</option>
        <option value="EUR">EUR</option>
        <option value="GBP">GBP</option>
      </select>

      <h3>Quote Items</h3>
      <div id="addItemPanel" class="add-item-panel" style="display:none;">
        <label>Item Name</label>
        <input type="text" id="ai_name" placeholder="Item name">
        <label>Quantity</label>
        <input type="number" id="ai_qty" min="1" value="1">
        <label>Description</label>
        <input type="text" id="ai_desc" placeholder="Description (optional)">
        <div class="inline-grid" style="margin-top:8px;">
          <div><label>Price NGN</label><input type="number" id="ai_price_ngn" step="0.01" inputmode="decimal"></div>
          <div><label>Price USD</label><input type="number" id="ai_price_usd" step="0.01" inputmode="decimal"></div>
          <div><label>Price EUR</label><input type="number" id="ai_price_eur" step="0.01" inputmode="decimal"></div>
          <div><label>Price GBP</label><input type="number" id="ai_price_gbp" step="0.01" inputmode="decimal"></div>
        </div>
        <div style="display:flex; gap:8px; margin-top:8px;">
          <button type="button" id="ai_add">Add</button>
          <button type="button" id="ai_cancel" style="background:#fff;color:#112e1f;border:1px solid #112e1f;">Cancel</button>
        </div>
      </div>

      <div id="quoteItems"></div>
      <button type="button" id="addQuoteItem">+ Add Item</button>

      <label style="margin-top:12px;">Total (optional)</label>
      <input type="number" id="quoteTotal" step="0.01" inputmode="decimal">

      <div style="display:flex; gap:8px; align-items:center; margin-top:8px;">
        <button type="button" id="generateQuoteLinkBtn" style="background:#0b6b4b;">Generate Link</button>
        <div id="generatedQuoteLink" style="margin-left:8px;"></div>
      </div>
    </form>
    <div id="quoteMessage" class="message"></div>

    <table id="quotesTable">
      <thead>
        <tr>
          <th>Customer</th><th>Email</th><th>Currency</th><th>Items</th><th>Totals</th><th>Link</th><th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- ORDERS -->
  <div class="section" id="ordersSection">
    <h2>Manage Orders</h2>
    <!-- Orders table unchanged -->
    <!-- ... existing orders code ... -->
  </div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script>
  // ================== FIREBASE ==================
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_BUCKET",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // ================== LOGIN ==================
  const loginContainer = document.getElementById("loginContainer");
  const dashboardContainer = document.getElementById("dashboardContainer");
  const loginForm = document.getElementById("loginForm");
  const loginMessage = document.getElementById("loginMessage");

  loginForm.addEventListener("submit", e => {
    e.preventDefault();
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;
    auth.signInWithEmailAndPassword(email, password)
      .then(() => {
        loginContainer.style.display="none";
        dashboardContainer.style.display="block";
      })
      .catch(err => { loginMessage.textContent = err.message; });
  });

  // ================== NAV ==================
  document.querySelectorAll(".dashboard-nav button").forEach(btn=>{
    btn.addEventListener("click",()=>{
      document.querySelectorAll(".section").forEach(sec=>sec.classList.remove("active"));
      document.getElementById(btn.dataset.target).classList.add("active");
    });
  });

  // ================== QUOTES ==================
  let quoteItemsArray = [];
  const quoteItemsDiv = document.getElementById("quoteItems");
  const addQuoteItemBtn = document.getElementById("addQuoteItem");
  const addItemPanel = document.getElementById("addItemPanel");
  const ai_add = document.getElementById("ai_add");
  const ai_cancel = document.getElementById("ai_cancel");
  const generatedQuoteLinkDiv = document.getElementById("generatedQuoteLink");

  addQuoteItemBtn.addEventListener("click",()=>{ addItemPanel.style.display="block"; });

  ai_cancel.addEventListener("click",()=>{
    addItemPanel.style.display="none";
    clearItemInputs();
  });

  ai_add.addEventListener("click",()=>{
    const item = {
      name: document.getElementById("ai_name").value,
      qty: document.getElementById("ai_qty").value,
      desc: document.getElementById("ai_desc").value,
      prices: {
        NGN: document.getElementById("ai_price_ngn").value,
        USD: document.getElementById("ai_price_usd").value,
        EUR: document.getElementById("ai_price_eur").value,
        GBP: document.getElementById("ai_price_gbp").value
      }
    };
    quoteItemsArray.push(item);
    renderQuoteItems();
    clearItemInputs();
    addItemPanel.style.display="none";
  });

  function clearItemInputs(){
    ["ai_name","ai_qty","ai_desc","ai_price_ngn","ai_price_usd","ai_price_eur","ai_price_gbp"].forEach(id=>{
      document.getElementById(id).value="";
    });
  }

  function renderQuoteItems(){
    quoteItemsDiv.innerHTML="";
    quoteItemsArray.forEach((it,i)=>{
      const div = document.createElement("div");
      div.className="quote-item";
      div.innerHTML=`<strong>${it.name}</strong> (${it.qty})<br>${it.desc}<br>
        NGN:${it.prices.NGN} USD:${it.prices.USD} EUR:${it.prices.EUR} GBP:${it.prices.GBP}
        <button type="button" onclick="removeQuoteItem(${i})" style="background:none;border:none;color:red;cursor:pointer;">Remove</button>`;
      quoteItemsDiv.appendChild(div);
    });
  }

  window.removeQuoteItem = function(i){
    quoteItemsArray.splice(i,1);
    renderQuoteItems();
  };

  document.getElementById("generateQuoteLinkBtn").addEventListener("click",()=>{
    const customer = document.getElementById("quoteCustomer").value;
    const email = document.getElementById("quoteEmail").value;
    const currency = document.getElementById("quoteCurrency").value;
    const total = document.getElementById("quoteTotal").value;

    if(!customer || !email || quoteItemsArray.length===0){ alert("Fill all required fields and add at least one item"); return; }

    const quoteData = { customer,email,currency,items:quoteItemsArray,total,status:"Pending",createdAt:new Date() };
    db.collection("quotes").add(quoteData)
      .then(docRef=>{
        const link = `${window.location.origin}/quote.html?id=${docRef.id}`;
        generatedQuoteLinkDiv.innerHTML=`<span>${link}</span> <button class="copy-btn" onclick="navigator.clipboard.writeText('${link}')">ðŸ“‹</button>`;
        quoteItemsArray=[]; renderQuoteItems();
        document.getElementById("quoteForm").reset();
        loadQuotes();
      })
      .catch(err=>{ alert(err.message); });
  });

  function loadQuotes(){
    const tbody = document.querySelector("#quotesTable tbody");
    tbody.innerHTML="";
    db.collection("quotes").orderBy("createdAt","desc").get()
      .then(snapshot=>{
        snapshot.forEach(doc=>{
          const q = doc.data();
          const tr = document.createElement("tr");
          tr.innerHTML=`
            <td>${q.customer}</td>
            <td>${q.email}</td>
            <td>${q.currency}</td>
            <td>${q.items.map(it=>`${it.name}(${it.qty})`).join(", ")}</td>
            <td>${q.total || "-"}</td>
            <td><a href="/quote.html?id=${doc.id}" target="_blank">Link</a></td>
            <td>
              <select onchange="updateQuoteStatus('${doc.id}',this.value)">
                <option ${q.status==="Pending"?"selected":""}>Pending</option>
                <option ${q.status==="Paid"?"selected":""}>Paid</option>
              </select>
            </td>
          `;
          tbody.appendChild(tr);
        });
      });
  }

  window.updateQuoteStatus=function(id,status){
    db.collection("quotes").doc(id).update({status});
  };

  auth.onAuthStateChanged(user=>{
    if(user){ loginContainer.style.display="none"; dashboardContainer.style.display="block"; loadQuotes(); }
  });

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thank You - SÃ©rac</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;scroll-behavior:smooth}
    body{
      font-family:"Montserrat",sans-serif;
      background:#141517;color:#fff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Header */
    .site-header{
      position:fixed;left:0;right:0;top:0;height:80px;
      display:flex;align-items:center;justify-content:space-between;
      padding:10px 20px;z-index:1200;background:transparent;
      transition:background .28s ease,backdrop-filter .28s ease,border-color .28s ease;
      border-bottom:1px solid rgba(255,255,255,0.02);
    }
    .site-header.scrolled{ background: rgba(20,21,23,0.95); backdrop-filter: blur(6px); border-bottom-color: rgba(255,255,255,0.04); }
    .header-left{display:flex;align-items:center;gap:16px}
    .brand-logo{height:64px;width:auto}
    .brand-title{font-family:"Playfair Display",serif;color:#B66E41;font-weight:700;font-size:1.6rem}
    .header-right{display:flex;gap:22px;align-items:center}
    .header-right a{color:#F5F5F3;text-decoration:none;font-weight:500}
    .hamburger{display:none;background:none;border:0;cursor:pointer;width:36px;height:28px;position:relative}
    .hamburger span{position:absolute;height:3px;background:#B66E41;width:100%;left:0;border-radius:2px;transition:all .28s}
    .hamburger span:nth-child(1){top:0}
    .hamburger span:nth-child(2){top:12px}
    .hamburger span:nth-child(3){top:24px}
    .hamburger.open span:nth-child(1){transform:rotate(45deg);top:12px}
    .hamburger.open span:nth-child(2){opacity:0}
    .hamburger.open span:nth-child(3){transform:rotate(-45deg);top:12px}

    
  /* Hamburger dropdown positioned under icon */
    @media(max-width:768px){
      .hamburger { display:block; }
    
      .header-right {
        position:absolute;
        top:80px;
        right:20px;
        display:none;
        flex-direction:column;
        background:rgba(20,21,23,0.98);
        border-radius:12px;
        overflow:hidden;
        box-shadow:0 6px 20px rgba(0,0,0,0.4);
        padding:12px 0;
        width:200px; /* optional fixed width for premium layout */
      }
    
      .header-right.open { display:flex; }
    
      .header-right a {
        padding:12px 16px;
        width:100%;
        text-align:left;
        color:#F5F5F3;
        text-decoration:none;
        transition:background .25s;
      }
    
      .header-right a:hover {
        background:rgba(182,110,65,0.12);
      }
    }

    /* Hero */
    .hero{height:90vh;display:flex;align-items:center;justify-content:center;text-align:center;position:relative}
    .hero::after{
      content:"";position:absolute;inset:0;background:url('asset/bg25.jpg') center/cover no-repeat;box-shadow:inset 0 0 0 2000px rgba(20,21,23,0.6);z-index:-1;
    }
    .hero h1{font-family:"Playfair Display",serif;color:#B66E41;font-size:clamp(36px,6vw,60px)}

    /* Main */
    /* Center the box in the viewport */
    .thankyou-section {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 100px 20px;
    }
    
    /* Center all content inside the box */
    .thankyou-box {
      max-width: 760px;
      background: #1c1e22;
      padding: 48px;
      border-radius: 16px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.6);
      color: #ddd;
      text-align: center;           /* âœ… Centers all text & inline elements */
      display: flex;                /* âœ… Enables internal centering */
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .thankyou-box h2{font-family:"Playfair Display",serif;color:#B66E41;margin-bottom:12px}
    .thankyou-box p{color:#ccc;margin-bottom:10px}

    #orderReferenceBox{
      background:#17181b;padding:14px 20px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);
      font-weight:600;font-size:18px;color:#fff;margin:14px 0;cursor:pointer;display:inline-block;
    }
    #orderReferenceNote{color:#999;font-size:13px;margin-bottom:12px}
    .order-details{background:#17181b;padding:18px;border-radius:10px;text-align:left;border:1px solid rgba(255,255,255,0.04)}
    .order-details h3{color:#B66E41;font-family:"Playfair Display",serif;margin-bottom:8px}
    .order-details li{color:#eee;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.02)}

    .btn{display:inline-block;padding:12px 26px;border-radius:8px;font-weight:600;cursor:pointer;margin-top:12px}
    .btn-primary{background:#B66E41;color:#fff;border:0}
    .btn-secondary{background:transparent;color:#B66E41;border:2px solid #B66E41}

    footer{padding:28px;text-align:center;color:#777;margin-top:60px}

    /* Overlay & spinner */
    #serac-overlay{
      position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;
      background:rgba(0,0,0,0.95);backdrop-filter:blur(6px);transition:opacity .45s ease;
    }
    .gold-spinner{
      width:64px;height:64px;border-radius:50%;
      border:5px solid rgba(182,110,65,0.18);border-top-color:#B66E41;animation:serac-spin 1s linear infinite;
      box-shadow:0 6px 26px rgba(0,0,0,0.6);
    }
    @keyframes serac-spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <!-- Loader overlay -->
  <div id="serac-overlay" aria-hidden="true">
    <div class="gold-spinner" role="status" aria-label="Loading"></div>
  </div>

  <header class="site-header" id="siteHeader">
    <div class="header-left">
      <img src="asset/logo.png" alt="SÃ©rac" class="brand-logo" />
      <div class="brand-title">SÃ©rac</div>
    </div>

    <nav class="header-right" id="headerRight">
      <a href="index.html">Home</a>
      <a href="shop.html">Shop</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
    </nav>

    <button class="hamburger" id="hamburger" aria-label="Menu" aria-expanded="false">
      <span></span><span></span><span></span>
    </button>
  </header>

  <main>
    <section class="hero"><h1>Thank You</h1></section>

    <section class="thankyou-section">
      <div class="thankyou-box">
        <h2>Weâ€™ve received your order ðŸŽ‰</h2>
        <p>Thank you for shopping with <strong>SÃ©rac</strong>. Your order is now being processed.</p>

        <div id="orderReferenceBox">Loading referenceâ€¦</div>
        <div id="orderReferenceNote"></div>

        <div style="margin:14px 0;">
          <button id="sendEmailBtn" class="btn btn-secondary">Send to my email</button>
        </div>

        <div class="order-details" id="orderDetails">
          <p>Loading order detailsâ€¦</p>
        </div>

        <div style="margin-top:18px">
          <a href="shop.html" class="btn btn-primary">Continue Shopping</a>
          <a id="trackOrderBtn" href="trackorder.html" class="btn btn-secondary">Track Order</a>
        </div>
      </div>
    </section>
  </main>

  <footer>Â© 2025 SÃ©rac</footer>

  <script type="module">
    // ------------- UI behavior -------------
    const overlay = document.getElementById('serac-overlay');
    const header = document.getElementById('siteHeader');
    const hamburger = document.getElementById('hamburger');
    const headerRight = document.getElementById('headerRight');

    // Scroll header
    window.addEventListener('scroll', () => header.classList.toggle('scrolled', window.scrollY > 30));

    // Hamburger mobile
    hamburger.addEventListener('click', () => {
      const open = headerRight.classList.toggle('open');
      hamburger.classList.toggle('open');
      hamburger.setAttribute('aria-expanded', String(open));
    });

    // ------------- Firestore imports -------------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";
    import { getFirestore, doc, getDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCuiZXHFYl1fVKnGwojavRvbekSBpkipJg",
      authDomain: "brandisby.firebaseapp.com",
      projectId: "brandisby",
      storageBucket: "brandisby.firebasestorage.app",
      messagingSenderId: "87213267039",
      appId: "1:87213267039:web:339e9fd49e3ad31f7423ea"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ------------- Helpers -------------
    function safeParseJSON(v){ try{ return JSON.parse(v||'null'); } catch(e){ return null; } }

    function showCopyPopup(text){
      const pop = document.createElement('div');
      pop.textContent = text;
      Object.assign(pop.style, {
        position:'fixed',left:'50%',bottom:'36px',transform:'translateX(-50%)',
        background:'#B66E41',color:'#fff',padding:'10px 16px',borderRadius:'8px',zIndex:10000,opacity:'0',transition:'opacity .25s'
      });
      document.body.appendChild(pop);
      requestAnimationFrame(()=> pop.style.opacity='1');
      setTimeout(()=> { pop.style.opacity='0'; setTimeout(()=>pop.remove(),280); },1800);
    }

    // ------------- Main display logic -------------
    async function displayOrder(){
      const refBox = document.getElementById('orderReferenceBox');
      const note = document.getElementById('orderReferenceNote');
      const details = document.getElementById('orderDetails');
      const trackBtn = document.getElementById('trackOrderBtn');
      const sendEmail = document.getElementById('sendEmailBtn');

      // 1) Prefer local saved order from checkout flow
      let order = safeParseJSON(localStorage.getItem('lastOrder_serac'));

      // 2) Check URL params (orderId, txref, quoteId)
      const params = new URLSearchParams(window.location.search);
      const orderId = params.get('orderId');
      const txref = params.get('txref') || params.get('ref') || null;
      const quoteId = params.get('quoteId');

      // 3) If no local order, try to fetch by orderId
      if(!order && orderId){
        try{
          const snap = await getDoc(doc(db, "brands", "serac", "orders", orderId));
          if(snap.exists()){ order = snap.data(); order.id = orderId; }
        }catch(e){ console.error('fetch order by id failed', e); }
      }

      // 4) If txref present and still no order, try as doc id then by trackingRef field
      if(!order && txref){
        try{
          // attempt doc id first
          const snap = await getDoc(doc(db, "brands", "serac", "orders", txref));
          if(snap.exists()){
            order = snap.data();
            order.id = snap.id;
          } else {
            // query by trackingRef field
            const q = query(collection(db, "brands", "serac", "orders"), where("trackingRef", "==", txref));
            const snaps = await getDocs(q);
            if(!snaps.empty){
              const s = snaps.docs[0];
              order = s.data(); order.id = s.id;
            }
          }
        }catch(e){ console.error('fetch by txref failed', e); }
      }

      // 5) If still no order, check paidQuoteInfo and/or fetch quote doc
      if(!order && (quoteId || safeParseJSON(localStorage.getItem('paidQuoteInfo'))?.quoteId )){
        const qid = quoteId || safeParseJSON(localStorage.getItem('paidQuoteInfo'))?.quoteId;
        try{
          const qsnap = await getDoc(doc(db, "brands", "serac", "quotes", qid));
          if(qsnap.exists()){
            const qdata = qsnap.data();
            order = {
              id: qid,
              type: 'quote',
              trackingRef: qdata.trackingRef || qdata.orderRef || null,
              name: qdata.name || qdata.customer || qdata.customerName || '',
              email: qdata.email || '',
              phone: qdata.phone || '',
              address: qdata.address || '',
              currency: qdata.currency || 'NGN',
              total: qdata.total || qdata.amount || qdata.subtotal || 0,
              items: qdata.items || []
            };
          }
        }catch(e){ console.error('fetch quote failed', e); }
      }

      // 6) If still nothing â€” display message and remove overlay
      if(!order){
        refBox.textContent = 'No order reference available.';
        note.textContent = '';
        details.innerHTML = '<p>Unable to locate order details. If you just paid, please wait a few moments and refresh.</p>';
        sendEmail.style.display = 'none';
        trackBtn.style.display = 'none';
        fadeRemoveOverlay();
        return;
      }

      // Normalize order for UI usage
      const ref = order.trackingRef || order.tracking || order.orderRef || order.id || 'N/A';
      refBox.textContent = ref;
      note.textContent = 'You can use this reference to track your order.';

      // clicking copies reference
      refBox.onclick = async () => {
        try {
          await navigator.clipboard.writeText(ref);
          showCopyPopup('Copied!');
        } catch(e){ console.error('copy failed', e); }
      };

      // Render details
      const currency = order.currency || order.currencyCode || 'NGN';
      const total = order.total ?? order.amount ?? order.subtotal ?? '-';
      let html = `<h3>Order Details</h3><ul>`;
      html += `<li><strong>Name:</strong> ${escapeHtml(order.name || order.customer || '-')}</li>`;
      html += `<li><strong>Email:</strong> ${escapeHtml(order.email || '-')}</li>`;
      html += `<li><strong>Phone:</strong> ${escapeHtml(order.phone || '-')}</li>`;
      html += `<li><strong>Address:</strong> ${escapeHtml(order.address || '-')}</li>`;
      html += `<li><strong>Currency:</strong> ${escapeHtml(currency)}</li>`;
      html += `<li><strong>Total Paid:</strong> ${escapeHtml(currency)} ${escapeHtml(String(total))}</li>`;
      html += `</ul><h3>Items</h3><ul>`;
      (order.items || []).forEach(i=>{
        const name = i.name || i.productName || i.title || 'Item';
        const qty = i.quantity || i.qty || i.count || 1;
        html += `<li>${escapeHtml(name)} (x${escapeHtml(String(qty))})</li>`;
      });
      html += `</ul>`;
      details.innerHTML = html;

      // Send email button
      sendEmail.onclick = () => {
        const subject = encodeURIComponent('Your SÃ©rac Order Confirmation');
        const body = encodeURIComponent(`Hello ${order.name || ''},

Thank you for shopping with SÃ©rac.

Order reference: ${ref}
Total: ${currency} ${total}

Track here: ${window.location.origin}/trackorder.html

Regards,
SÃ©rac`);
        window.location.href = `mailto:${order.email || ''}?subject=${subject}&body=${body}`;
      };

      // Track button simply goes to trackorder.html
      trackBtn.href = 'trackorder.html';

      // cleanup saved local copies (if any)
      try{ localStorage.removeItem('lastOrder_serac'); localStorage.removeItem('paidQuoteInfo'); }catch(e){}

      // done -> fade overlay after small delay to make transition premium
      setTimeout(fadeRemoveOverlay, 500);
    }

    // small helper to safely escape text for insertion
    function escapeHtml(s){
      if(s === undefined || s === null) return '';
      return String(s).replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[ch]));
    }

    function fadeRemoveOverlay(){
      if(!overlay) return;
      overlay.style.opacity = '0';
      setTimeout(()=>{ overlay.remove?.() }, 600);
    }

    // Start after DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      // Ensure overlay is visible until finish
      try{ overlay.style.opacity = '1'; } catch(e){}
      displayOrder().catch(err => {
        console.error('displayOrder error', err);
        fadeRemoveOverlay();
      });
    });
  </script>
</body>
</html>
